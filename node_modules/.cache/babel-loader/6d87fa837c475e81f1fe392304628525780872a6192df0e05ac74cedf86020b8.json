{"ast":null,"code":"// src/components/CustomizationModal/CustomizationModal.jsx\nimport React,{useState,useContext,useEffect,useCallback,useMemo}from'react';import{X,Plus,Minus,Info,Check,Loader,Pizza,Upload,ShoppingCart}from'lucide-react';import{CartContext}from'../../context/CartContext';import woocommerceApi from'../../services/woocommerceApi';import'./CustomizationModal.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const CustomizationModal=_ref=>{let{product,isOpen,onClose}=_ref;const{addToCart}=useContext(CartContext);// Estados para datos de WooCommerce\nconst[variations,setVariations]=useState([]);const[attributes,setAttributes]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Estados para Advanced Product Fields\nconst[productAddons,setProductAddons]=useState([]);const[addonValues,setAddonValues]=useState({});const[addonFiles,setAddonFiles]=useState({});// Estados de selección\nconst[selectedAttributes,setSelectedAttributes]=useState({});const[selectedVariation,setSelectedVariation]=useState(null);const[quantity,setQuantity]=useState(1);const[specialInstructions,setSpecialInstructions]=useState('');const[addingToCart,setAddingToCart]=useState(false);// Reset estados cuando se abre el modal\nuseEffect(()=>{if(isOpen&&product){resetForm();loadProductData();}},[isOpen,product]);const resetForm=()=>{setSelectedAttributes({});setSelectedVariation(null);setQuantity(1);setSpecialInstructions('');setProductAddons([]);setAddonValues({});setAddonFiles({});setError(null);};const loadProductData=async()=>{setLoading(true);setError(null);try{// Si es un producto variable, cargar variaciones\nif(product.type==='variable'){const variationsData=await woocommerceApi.getProductVariations(product.id);setVariations(variationsData||[]);// Extraer atributos del producto\nif(product.attributes){const variableAttributes=product.attributes.filter(attr=>attr.variation);setAttributes(variableAttributes);// Buscar la variación con el precio más alto\nconst highestPriceVariation=variationsData.reduce((prev,current)=>{const prevPrice=parseFloat(prev.price)||0;const currentPrice=parseFloat(current.price)||0;return currentPrice>prevPrice?current:prev;},variationsData[0]);// Establecer valores por defecto basados en la variación de mayor precio\nconst defaultAttributes={};if(highestPriceVariation&&highestPriceVariation.attributes){highestPriceVariation.attributes.forEach(varAttr=>{// Encontrar el atributo correspondiente en los atributos del producto\nconst productAttr=variableAttributes.find(attr=>attr.name===varAttr.name||attr.name.toLowerCase()===varAttr.name.toLowerCase());if(productAttr){defaultAttributes[productAttr.name]=varAttr.option;}});}else{// Fallback: si no encontramos la variación de mayor precio\nvariableAttributes.forEach(attr=>{if(attr.options&&attr.options.length>0){// Si el atributo es \"Tamaño\", buscar \"Familiar\" primero\nif(attr.name.toLowerCase()==='tamaño'||attr.name.toLowerCase()==='tamano'){const familiarOption=attr.options.find(opt=>opt.toLowerCase()==='familiar');defaultAttributes[attr.name]=familiarOption||attr.options[0];}else{defaultAttributes[attr.name]=attr.options[0];}}});}setSelectedAttributes(defaultAttributes);setSelectedVariation(highestPriceVariation);}}// Cargar Advanced Product Fields si existen\nawait loadProductAddons();}catch(err){console.error('Error loading product data:',err);setError('Error al cargar las opciones del producto. Por favor, intenta de nuevo.');}finally{setLoading(false);}};const loadProductAddons=async()=>{// Verificar si el producto tiene campos adicionales del plugin Advanced Product Fields\nif(product.meta_data){// Buscar el campo _wapf_fieldgroup\nconst fieldGroupData=product.meta_data.find(meta=>meta.key==='_wapf_fieldgroup');if(fieldGroupData&&fieldGroupData.value){// El valor puede ser un ID de grupo o un array de IDs\nlet groupIds=[];if(Array.isArray(fieldGroupData.value)){groupIds=fieldGroupData.value;}else if(typeof fieldGroupData.value==='object'&&fieldGroupData.value.groups){groupIds=fieldGroupData.value.groups;}else if(typeof fieldGroupData.value==='string'||typeof fieldGroupData.value==='number'){groupIds=[fieldGroupData.value];}// Si tenemos IDs de grupos, necesitamos obtener los campos de esos grupos\n// Por ahora, vamos a buscar si hay campos directamente en el producto\nconst possibleFieldKeys=['_wapf_fields','_wapf_field_groups_fields','wapf_fields','_product_addons'];for(const key of possibleFieldKeys){const fieldsData=product.meta_data.find(meta=>meta.key===key);if(fieldsData&&fieldsData.value){const fields=Array.isArray(fieldsData.value)?fieldsData.value:[fieldsData.value];setProductAddons(fields);initializeAddonValues(fields);return;}}// Si no encontramos los campos compilados, intentamos obtenerlos via API personalizada\nif(groupIds.length>0||true){// Siempre intentar con la API personalizada\ntry{// Construir la URL completa\nconst apiUrl=`https://escandalosospizzas.cl/wp/wp-json/custom/v1/product-fields/${product.id}`;const response=await fetch(apiUrl);if(response.ok){const data=await response.json();// Intentar diferentes estructuras de respuesta\nlet fields=null;// ESTRUCTURA ESPECÍFICA DE WAPF (Advanced Product Fields)\nif(data&&data.field_groups&&data.field_groups.fields){fields=data.field_groups.fields;}// Si la respuesta es un array directo\nelse if(Array.isArray(data)){fields=data;}// Si los campos están en data.fields\nelse if(data&&data.fields&&Array.isArray(data.fields)){fields=data.fields;}// Si los campos están en data.data\nelse if(data&&data.data){fields=data.data;}// Si la respuesta tiene una propiedad items\nelse if(data&&data.items){fields=data.items;}// Si la respuesta tiene una propiedad addons\nelse if(data&&data.addons){fields=data.addons;}// Si la respuesta tiene una propiedad product_fields\nelse if(data&&data.product_fields){fields=data.product_fields;}// Si la respuesta es un objeto con campos como propiedades\nelse if(data&&typeof data==='object'&&!Array.isArray(data)){// Buscar cualquier propiedad que sea un array\nconst keys=Object.keys(data);for(const key of keys){if(Array.isArray(data[key])){fields=data[key];break;}}// Si no encontramos arrays, tal vez los campos están directamente en el objeto\nif(!fields&&keys.length>0){// Verificar si el objeto tiene estructura de campo\nconst firstKey=keys[0];if(data[firstKey]&&(data[firstKey].type||data[firstKey].label||data[firstKey].name)){// Convertir el objeto en array\nfields=Object.values(data);}}}if(fields){setProductAddons(fields);initializeAddonValues(fields);}}}catch(error){console.error('Error obteniendo campos via API:',error);}}}}// Si no encontramos campos via meta_data, verificar si están directamente en el producto\nif(product.product_fields){setProductAddons(product.product_fields);initializeAddonValues(product.product_fields);}else if(product.addons){setProductAddons(product.addons);initializeAddonValues(product.addons);}};const initializeAddonValues=fields=>{const defaultValues={};fields.forEach(field=>{const fieldId=field.id||field.name||field.field_id;if(field.type==='checkbox'||field.type==='checkboxes'||field.type==='multiple_choice'){defaultValues[fieldId]=[];}else if(field.type==='number'&&field.min!==undefined){defaultValues[fieldId]=field.min;}else if(field.type==='true_false'){defaultValues[fieldId]=false;}else if(field.type==='radio'||field.type==='radiobutton'){var _field$options;// Para radio buttons, buscar si hay una opción seleccionada por defecto\nconst choices=((_field$options=field.options)===null||_field$options===void 0?void 0:_field$options.choices)||field.options||[];const defaultChoice=choices.find(choice=>choice.selected===true);defaultValues[fieldId]=defaultChoice?defaultChoice.label||defaultChoice.value:'';}else{defaultValues[fieldId]='';}});setAddonValues(defaultValues);};const handleAttributeChange=useCallback((attributeName,value)=>{setSelectedAttributes(prev=>{const newAttributes={...prev,[attributeName]:value};// Buscar variación que coincida en el siguiente render\nsetTimeout(()=>findMatchingVariation(newAttributes),0);return newAttributes;});},[variations]);const findMatchingVariation=useCallback(attributes=>{if(!variations||variations.length===0)return;const matching=variations.find(variation=>{return variation.attributes.every(attr=>{// Normalizar nombres de atributos\nconst normalizedAttrName=attr.name.toLowerCase().replace(/-/g,' ');const selectedValue=attributes[attr.name]||attributes[normalizedAttrName];// Comparar valores normalizados también\nconst normalizedOption=attr.option.toLowerCase();const normalizedSelected=selectedValue===null||selectedValue===void 0?void 0:selectedValue.toLowerCase();return normalizedOption===normalizedSelected||selectedValue==attr.option;});});setSelectedVariation(matching||null);},[variations]);const handleAddonChange=useCallback((fieldId,value)=>{setAddonValues(prev=>({...prev,[fieldId]:value}));},[]);const handleFileUpload=useCallback((fieldId,file)=>{if(file){setAddonFiles(prev=>({...prev,[fieldId]:file}));setAddonValues(prev=>({...prev,[fieldId]:file.name}));}},[]);// Memorizar el cálculo del precio de addons\nconst addonPrice=useMemo(()=>{let addonTotal=0;productAddons.forEach(addon=>{var _addon$options,_addon$options2;const fieldId=addon.id||addon.name;const value=addonValues[fieldId];if(!value||Array.isArray(value)&&value.length===0)return;// Para WAPF, el precio puede estar en addon.pricing\nif(addon.pricing&&addon.pricing.enabled&&addon.pricing.amount){if(addon.pricing.type==='fixed'){addonTotal+=parseFloat(addon.pricing.amount);}else if(addon.pricing.type==='quantity_based'){addonTotal+=parseFloat(addon.pricing.amount)*quantity;}}// Precio fijo tradicional\nelse if(addon.price_type==='flat_fee'&&addon.price){addonTotal+=parseFloat(addon.price);}// Precio basado en cantidad\nelse if(addon.price_type==='quantity_based'&&addon.price){addonTotal+=parseFloat(addon.price)*quantity;}// Precio por carácter (para campos de texto)\nelse if(addon.price_type==='per_char'&&addon.price&&typeof value==='string'){addonTotal+=parseFloat(addon.price)*value.length;}// Para campos con opciones (radio, select, checkbox)\nelse if(((_addon$options=addon.options)!==null&&_addon$options!==void 0&&_addon$options.choices||addon.options)&&Array.isArray(((_addon$options2=addon.options)===null||_addon$options2===void 0?void 0:_addon$options2.choices)||addon.options)){var _addon$options3;const options=((_addon$options3=addon.options)===null||_addon$options3===void 0?void 0:_addon$options3.choices)||addon.options;options.forEach(option=>{const isSelected=Array.isArray(value)?value.includes(option.label||option.value):value===(option.label||option.value);if(isSelected&&(option.pricing_amount||option.price)){const optionPrice=option.pricing_amount||option.price;if(option.pricing_type==='quantity_based'||option.price_type==='quantity_based'){addonTotal+=parseFloat(optionPrice)*quantity;}else{addonTotal+=parseFloat(optionPrice);}}});}});return addonTotal;},[productAddons,addonValues,quantity]);// Memorizar el precio total\nconst totalPrice=useMemo(()=>{let basePrice=0;if(selectedVariation&&selectedVariation.price){basePrice=parseFloat(selectedVariation.price);}else if(product&&product.price){basePrice=parseFloat(product.price);}return(basePrice+addonPrice)*quantity;},[selectedVariation,product,addonPrice,quantity]);const formatPrice=price=>{return new Intl.NumberFormat('es-CL',{style:'currency',currency:'CLP',minimumFractionDigits:0,maximumFractionDigits:0}).format(price);};const isValidSelection=()=>{if(product.type==='variable'){// Para productos variables, verificar que se haya seleccionado una variación válida\nif(!selectedVariation||selectedVariation.stock_status==='outofstock'){return false;}}// Validar campos requeridos de Advanced Product Fields\nfor(const addon of productAddons){if(addon.required){const fieldId=addon.id||addon.name;const value=addonValues[fieldId];if(!value||Array.isArray(value)&&value.length===0){setError(`Por favor, completa el campo: ${addon.title||addon.name}`);return false;}}}return true;};const handleAddToCart=async()=>{if(!isValidSelection()){if(!error){setError('Por favor, selecciona todas las opciones requeridas');}return;}setAddingToCart(true);try{var _selectedVariation$im,_product$images,_product$images$;// Preparar meta_data para Advanced Product Fields\nconst addonMetaData=[];productAddons.forEach(addon=>{const fieldId=addon.id||addon.name;const value=addonValues[fieldId];if(value&&!(Array.isArray(value)&&value.length===0)){var _addon$options4,_addon$options5;// Calcular el precio del addon\nlet addonPrice=0;let priceType='flat_fee';// Para WAPF, el precio puede estar en addon.pricing\nif(addon.pricing&&addon.pricing.enabled&&addon.pricing.amount){addonPrice=parseFloat(addon.pricing.amount);priceType=addon.pricing.type||'fixed';}// Precio tradicional\nelse if(addon.price){addonPrice=parseFloat(addon.price);priceType=addon.price_type||'flat_fee';}// Para campos con opciones, buscar el precio de la opción seleccionada\nif(((_addon$options4=addon.options)!==null&&_addon$options4!==void 0&&_addon$options4.choices||addon.options)&&Array.isArray(((_addon$options5=addon.options)===null||_addon$options5===void 0?void 0:_addon$options5.choices)||addon.options)){var _addon$options6;const options=((_addon$options6=addon.options)===null||_addon$options6===void 0?void 0:_addon$options6.choices)||addon.options;options.forEach(option=>{const isSelected=Array.isArray(value)?value.includes(option.label||option.value):value===(option.label||option.value);if(isSelected&&(option.pricing_amount||option.price)){addonPrice=parseFloat(option.pricing_amount||option.price);priceType=option.pricing_type||option.price_type||'flat_fee';}});}// Agregar el campo a meta_data\naddonMetaData.push({key:addon.name||addon.title,value:Array.isArray(value)?value.join(', '):value,display:addon.title||addon.name,price:addonPrice,price_type:priceType});}});const cartItem={id:selectedVariation?`${product.id}-${selectedVariation.id}-${Date.now()}`:`${product.id}-${Date.now()}`,productId:product.id,variationId:selectedVariation===null||selectedVariation===void 0?void 0:selectedVariation.id,name:product.name,price:totalPrice/quantity,// Precio unitario incluyendo addons\nimage:(selectedVariation===null||selectedVariation===void 0?void 0:(_selectedVariation$im=selectedVariation.image)===null||_selectedVariation$im===void 0?void 0:_selectedVariation$im.src)||((_product$images=product.images)===null||_product$images===void 0?void 0:(_product$images$=_product$images[0])===null||_product$images$===void 0?void 0:_product$images$.src)||'',quantity,customizations:{attributes:selectedAttributes,specialInstructions:specialInstructions.trim(),variationDetails:selectedVariation?{name:selectedVariation.name,attributes:selectedVariation.attributes}:null,// Agregar datos de Advanced Product Fields\nproductAddons:addonMetaData,addonValues:addonValues,addonFiles:Object.keys(addonFiles).length>0?addonFiles:null,// Agregar el precio total de los addons\naddonsPrice:addonPrice}};addToCart(cartItem);// Mostrar mensaje de éxito\nsetTimeout(()=>{onClose();resetForm();},500);}catch(err){setError('Error al agregar al carrito. Por favor, intenta de nuevo.');}finally{setAddingToCart(false);}};const renderAddonField=addon=>{var _addon$options7,_addon$options8,_addon$options9;const fieldId=addon.id||addon.name;const value=addonValues[fieldId]||'';switch(addon.type){case'text':case'custom_text':return/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:value,onChange:e=>handleAddonChange(fieldId,e.target.value),placeholder:addon.placeholder||'',maxLength:addon.max||undefined,className:\"addon-text-input\",required:addon.required});case'textarea':case'custom_textarea':return/*#__PURE__*/_jsx(\"textarea\",{value:value,onChange:e=>handleAddonChange(fieldId,e.target.value),placeholder:addon.placeholder||'',maxLength:addon.max||undefined,rows:4,className:\"addon-textarea\",required:addon.required});case'number':return/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:value,onChange:e=>handleAddonChange(fieldId,parseFloat(e.target.value)||0),min:addon.min||undefined,max:addon.max||undefined,step:addon.step||1,className:\"addon-number-input\",required:addon.required});case'email':return/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:value,onChange:e=>handleAddonChange(fieldId,e.target.value),placeholder:addon.placeholder||'email@ejemplo.com',className:\"addon-email-input\",required:addon.required});case'select':case'dropdown':const selectOptions=((_addon$options7=addon.options)===null||_addon$options7===void 0?void 0:_addon$options7.choices)||addon.options||[];return/*#__PURE__*/_jsxs(\"select\",{value:value,onChange:e=>handleAddonChange(fieldId,e.target.value),className:\"addon-select\",required:addon.required,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Selecciona una opci\\xF3n\"}),selectOptions.map((option,index)=>/*#__PURE__*/_jsxs(\"option\",{value:option.label||option.value,children:[option.label||option.value,option.pricing_amount&&option.pricing_amount>0&&` (+${formatPrice(option.pricing_amount)})`]},index))]});case'radio':case'radiobutton':// Obtener las opciones correctamente según la estructura de WAPF\nconst radioOptions=((_addon$options8=addon.options)===null||_addon$options8===void 0?void 0:_addon$options8.choices)||addon.options||[];return/*#__PURE__*/_jsx(\"div\",{className:\"addon-radio-group\",children:radioOptions.map((option,index)=>/*#__PURE__*/_jsxs(\"label\",{className:\"addon-radio-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:fieldId,value:option.label||option.value,checked:value===(option.label||option.value),onChange:e=>handleAddonChange(fieldId,e.target.value),required:addon.required}),/*#__PURE__*/_jsxs(\"span\",{className:\"radio-label\",children:[option.label||option.value,option.pricing_amount&&option.pricing_amount>0&&` (+${formatPrice(option.pricing_amount)})`]})]},index))});case'checkbox':case'checkboxes':case'multiple_choice':const checkboxOptions=((_addon$options9=addon.options)===null||_addon$options9===void 0?void 0:_addon$options9.choices)||addon.options||[];return/*#__PURE__*/_jsx(\"div\",{className:\"addon-checkbox-group\",children:checkboxOptions.map((option,index)=>/*#__PURE__*/_jsxs(\"label\",{className:\"addon-checkbox-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:option.label||option.value,checked:Array.isArray(value)&&value.includes(option.label||option.value),onChange:e=>{const optionValue=option.label||option.value;const currentValues=Array.isArray(value)?value:[];if(e.target.checked){handleAddonChange(fieldId,[...currentValues,optionValue]);}else{handleAddonChange(fieldId,currentValues.filter(v=>v!==optionValue));}}}),/*#__PURE__*/_jsxs(\"span\",{className:\"checkbox-label\",children:[option.label||option.value,option.pricing_amount&&option.pricing_amount>0&&` (+${formatPrice(option.pricing_amount)})`]})]},index))});case'file':case'file_upload':return/*#__PURE__*/_jsxs(\"div\",{className:\"addon-file-upload\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"file-upload-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:e=>handleFileUpload(fieldId,e.target.files[0]),accept:addon.allowed_types||'*',required:addon.required,className:\"file-input\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"file-upload-button\",children:[/*#__PURE__*/_jsx(Upload,{size:16}),addonFiles[fieldId]?addonFiles[fieldId].name:'Seleccionar archivo']})]}),addon.max_size&&/*#__PURE__*/_jsxs(\"p\",{className:\"file-size-info\",children:[\"Tama\\xF1o m\\xE1ximo: \",addon.max_size,\"MB\"]})]});case'color':return/*#__PURE__*/_jsx(\"input\",{type:\"color\",value:value||'#000000',onChange:e=>handleAddonChange(fieldId,e.target.value),className:\"addon-color-input\",required:addon.required});case'date':return/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:value,onChange:e=>handleAddonChange(fieldId,e.target.value),min:addon.min_date||undefined,max:addon.max_date||undefined,className:\"addon-date-input\",required:addon.required});case'true_false':return/*#__PURE__*/_jsxs(\"label\",{className:\"addon-checkbox-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:value===true,onChange:e=>handleAddonChange(fieldId,e.target.checked),required:addon.required}),/*#__PURE__*/_jsx(\"span\",{className:\"checkbox-label\",children:addon.true_label||'Sí'})]});default:return null;}};if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"customization-modal-overlay\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"customization-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:onClose,children:/*#__PURE__*/_jsx(X,{size:24})}),/*#__PURE__*/_jsx(\"h2\",{children:\"Personalizar Pedido\"}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(Loader,{className:\"loading-spinner\",size:48}),/*#__PURE__*/_jsx(\"p\",{children:\"Cargando opciones...\"})]}):error?/*#__PURE__*/_jsxs(\"div\",{className:\"error-container\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:loadProductData,className:\"retry-button\",children:\"Reintentar\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"customization-product-info\",children:[product.images&&product.images[0]?/*#__PURE__*/_jsx(\"img\",{src:product.images[0].src,alt:product.name,className:\"customization-product-image\"}):/*#__PURE__*/_jsx(\"div\",{className:\"customization-product-image placeholder\",children:/*#__PURE__*/_jsx(Pizza,{size:48})}),/*#__PURE__*/_jsxs(\"div\",{className:\"product-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:product.name}),product.short_description&&/*#__PURE__*/_jsx(\"p\",{className:\"product-description\",dangerouslySetInnerHTML:{__html:product.short_description}}),!product.short_description&&product.description&&/*#__PURE__*/_jsx(\"p\",{className:\"product-description\",dangerouslySetInnerHTML:{__html:product.description}}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-price\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"price-label\",children:\"Precio: \"}),/*#__PURE__*/_jsx(\"span\",{className:\"price-value\",children:formatPrice(totalPrice/quantity)}),selectedVariation&&selectedVariation.attributes&&/*#__PURE__*/_jsxs(\"span\",{className:\"price-variant\",children:[\" - \",selectedVariation.attributes.map(attr=>attr.option).join(', ')]})]})]})]}),attributes.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"customization-section\",children:attributes.map(attribute=>/*#__PURE__*/_jsxs(\"div\",{className:\"attribute-section\",children:[/*#__PURE__*/_jsx(\"h4\",{children:attribute.name}),attribute.description&&/*#__PURE__*/_jsx(\"p\",{className:\"section-description\",children:attribute.description}),/*#__PURE__*/_jsx(\"div\",{className:\"attribute-options\",children:attribute.options.sort((a,b)=>{// Si es el atributo de tamaño, ordenar para que Familiar aparezca primero\nif(attribute.name.toLowerCase()==='tamaño'||attribute.name.toLowerCase()==='tamano'){if(a.toLowerCase()==='familiar')return-1;if(b.toLowerCase()==='familiar')return 1;}return 0;}).map(option=>/*#__PURE__*/_jsxs(\"label\",{className:\"attribute-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:attribute.name,value:option,checked:selectedAttributes[attribute.name]===option,onChange:()=>handleAttributeChange(attribute.name,option)}),/*#__PURE__*/_jsxs(\"span\",{className:\"option-label\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"option-check\",children:/*#__PURE__*/_jsx(Check,{size:16})}),option]})]},option))})]},attribute.id||attribute.name))}),productAddons.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"customization-section\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Opciones adicionales\"}),productAddons.map((addon,index)=>{var _addon$pricing,_addon$pricing2;return/*#__PURE__*/_jsxs(\"div\",{className:\"addon-field\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"addon-label\",children:[addon.label||addon.title||addon.name||'Campo adicional',addon.required&&/*#__PURE__*/_jsx(\"span\",{className:\"required\",children:\"*\"}),((_addon$pricing=addon.pricing)===null||_addon$pricing===void 0?void 0:_addon$pricing.enabled)&&((_addon$pricing2=addon.pricing)===null||_addon$pricing2===void 0?void 0:_addon$pricing2.amount)>0&&/*#__PURE__*/_jsx(\"span\",{className:\"addon-price\",children:addon.pricing.type==='quantity_based'?` (+${formatPrice(addon.pricing.amount)} por unidad)`:` (+${formatPrice(addon.pricing.amount)})`})]}),addon.description&&/*#__PURE__*/_jsx(\"p\",{className:\"addon-description\",children:addon.description}),renderAddonField(addon)]},addon.id||addon.name||index);})]}),selectedVariation&&(selectedVariation.stock_status==='outofstock'||selectedVariation.stock_quantity&&selectedVariation.stock_quantity<10)&&/*#__PURE__*/_jsx(\"div\",{className:\"variation-info\",children:/*#__PURE__*/_jsx(\"div\",{className:\"variation-details\",children:selectedVariation.stock_status==='outofstock'?/*#__PURE__*/_jsx(\"p\",{className:\"out-of-stock\",children:\"\\u26A0\\uFE0F Producto agotado\"}):selectedVariation.stock_quantity&&selectedVariation.stock_quantity<10?/*#__PURE__*/_jsxs(\"p\",{className:\"low-stock\",children:[\"\\u26A1 \\xDAltimas \",selectedVariation.stock_quantity,\" unidades\"]}):null})}),/*#__PURE__*/_jsxs(\"div\",{className:\"customization-section\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Instrucciones especiales (opcional)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"section-description\",children:\"\\xBFAlguna preferencia especial?\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"special-instructions\",value:specialInstructions,onChange:e=>setSpecialInstructions(e.target.value),placeholder:\"Ej: Sin cebolla, extra queso, etc.\",rows:3})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"quantity-price-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"quantity-selector\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Cantidad\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"quantity-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setQuantity(Math.max(1,quantity-1)),disabled:quantity<=1,children:/*#__PURE__*/_jsx(Minus,{size:20})}),/*#__PURE__*/_jsx(\"span\",{className:\"quantity-value\",children:quantity}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setQuantity(quantity+1),disabled:(selectedVariation===null||selectedVariation===void 0?void 0:selectedVariation.stock_status)==='outofstock',children:/*#__PURE__*/_jsx(Plus,{size:20})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"price-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Total\"}),/*#__PURE__*/_jsx(\"p\",{className:\"total-price\",children:formatPrice(totalPrice)})]})]}),/*#__PURE__*/_jsx(\"button\",{className:`add-to-cart-button ${addingToCart?'loading':''}`,onClick:handleAddToCart,disabled:addingToCart||(selectedVariation===null||selectedVariation===void 0?void 0:selectedVariation.stock_status)==='outofstock',children:addingToCart?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Loader,{className:\"button-spinner\",size:20}),\"Agregando...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ShoppingCart,{size:20}),\"Agregar al Carrito\"]})})]})]})});};export default CustomizationModal;","map":{"version":3,"names":["React","useState","useContext","useEffect","useCallback","useMemo","X","Plus","Minus","Info","Check","Loader","Pizza","Upload","ShoppingCart","CartContext","woocommerceApi","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CustomizationModal","_ref","product","isOpen","onClose","addToCart","variations","setVariations","attributes","setAttributes","loading","setLoading","error","setError","productAddons","setProductAddons","addonValues","setAddonValues","addonFiles","setAddonFiles","selectedAttributes","setSelectedAttributes","selectedVariation","setSelectedVariation","quantity","setQuantity","specialInstructions","setSpecialInstructions","addingToCart","setAddingToCart","resetForm","loadProductData","type","variationsData","getProductVariations","id","variableAttributes","filter","attr","variation","highestPriceVariation","reduce","prev","current","prevPrice","parseFloat","price","currentPrice","defaultAttributes","forEach","varAttr","productAttr","find","name","toLowerCase","option","options","length","familiarOption","opt","loadProductAddons","err","console","meta_data","fieldGroupData","meta","key","value","groupIds","Array","isArray","groups","possibleFieldKeys","fieldsData","fields","initializeAddonValues","apiUrl","response","fetch","ok","data","json","field_groups","items","addons","product_fields","keys","Object","firstKey","label","values","defaultValues","field","fieldId","field_id","min","undefined","_field$options","choices","defaultChoice","choice","selected","handleAttributeChange","attributeName","newAttributes","setTimeout","findMatchingVariation","matching","every","normalizedAttrName","replace","selectedValue","normalizedOption","normalizedSelected","handleAddonChange","handleFileUpload","file","addonPrice","addonTotal","addon","_addon$options","_addon$options2","pricing","enabled","amount","price_type","_addon$options3","isSelected","includes","pricing_amount","optionPrice","pricing_type","totalPrice","basePrice","formatPrice","Intl","NumberFormat","style","currency","minimumFractionDigits","maximumFractionDigits","format","isValidSelection","stock_status","required","title","handleAddToCart","_selectedVariation$im","_product$images","_product$images$","addonMetaData","_addon$options4","_addon$options5","priceType","_addon$options6","push","join","display","cartItem","Date","now","productId","variationId","image","src","images","customizations","trim","variationDetails","addonsPrice","renderAddonField","_addon$options7","_addon$options8","_addon$options9","onChange","e","target","placeholder","maxLength","max","className","rows","step","selectOptions","children","map","index","radioOptions","checked","checkboxOptions","optionValue","currentValues","v","files","accept","allowed_types","size","max_size","min_date","max_date","true_label","onClick","stopPropagation","alt","short_description","dangerouslySetInnerHTML","__html","description","attribute","sort","a","b","_addon$pricing","_addon$pricing2","stock_quantity","Math","disabled"],"sources":["/Users/franciscalabra/Desktop/escandalosos/src/components/CustomizationModal/CustomizationModal.jsx"],"sourcesContent":["// src/components/CustomizationModal/CustomizationModal.jsx\nimport React, { useState, useContext, useEffect, useCallback, useMemo } from 'react';\nimport { X, Plus, Minus, Info, Check, Loader, Pizza, Upload, ShoppingCart } from 'lucide-react';\nimport { CartContext } from '../../context/CartContext';\nimport woocommerceApi from '../../services/woocommerceApi';\nimport './CustomizationModal.css';\n\nconst CustomizationModal = ({ product, isOpen, onClose }) => {\n  const { addToCart } = useContext(CartContext);\n  \n  // Estados para datos de WooCommerce\n  const [variations, setVariations] = useState([]);\n  const [attributes, setAttributes] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  \n  // Estados para Advanced Product Fields\n  const [productAddons, setProductAddons] = useState([]);\n  const [addonValues, setAddonValues] = useState({});\n  const [addonFiles, setAddonFiles] = useState({});\n  \n  // Estados de selección\n  const [selectedAttributes, setSelectedAttributes] = useState({});\n  const [selectedVariation, setSelectedVariation] = useState(null);\n  const [quantity, setQuantity] = useState(1);\n  const [specialInstructions, setSpecialInstructions] = useState('');\n  const [addingToCart, setAddingToCart] = useState(false);\n\n  // Reset estados cuando se abre el modal\n  useEffect(() => {\n    if (isOpen && product) {\n      resetForm();\n      loadProductData();\n    }\n  }, [isOpen, product]);\n\n  const resetForm = () => {\n    setSelectedAttributes({});\n    setSelectedVariation(null);\n    setQuantity(1);\n    setSpecialInstructions('');\n    setProductAddons([]);\n    setAddonValues({});\n    setAddonFiles({});\n    setError(null);\n  };\n\n  const loadProductData = async () => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      // Si es un producto variable, cargar variaciones\n      if (product.type === 'variable') {\n        const variationsData = await woocommerceApi.getProductVariations(product.id);\n        setVariations(variationsData || []);\n        \n        // Extraer atributos del producto\n        if (product.attributes) {\n          const variableAttributes = product.attributes.filter(attr => attr.variation);\n          setAttributes(variableAttributes);\n          \n          // Buscar la variación con el precio más alto\n          const highestPriceVariation = variationsData.reduce((prev, current) => {\n            const prevPrice = parseFloat(prev.price) || 0;\n            const currentPrice = parseFloat(current.price) || 0;\n            return currentPrice > prevPrice ? current : prev;\n          }, variationsData[0]);\n\n          // Establecer valores por defecto basados en la variación de mayor precio\n          const defaultAttributes = {};\n          if (highestPriceVariation && highestPriceVariation.attributes) {\n            highestPriceVariation.attributes.forEach(varAttr => {\n              // Encontrar el atributo correspondiente en los atributos del producto\n              const productAttr = variableAttributes.find(attr => \n                attr.name === varAttr.name || \n                attr.name.toLowerCase() === varAttr.name.toLowerCase()\n              );\n              \n              if (productAttr) {\n                defaultAttributes[productAttr.name] = varAttr.option;\n              }\n            });\n          } else {\n            // Fallback: si no encontramos la variación de mayor precio\n            variableAttributes.forEach(attr => {\n              if (attr.options && attr.options.length > 0) {\n                // Si el atributo es \"Tamaño\", buscar \"Familiar\" primero\n                if (attr.name.toLowerCase() === 'tamaño' || attr.name.toLowerCase() === 'tamano') {\n                  const familiarOption = attr.options.find(opt => \n                    opt.toLowerCase() === 'familiar'\n                  );\n                  defaultAttributes[attr.name] = familiarOption || attr.options[0];\n                } else {\n                  defaultAttributes[attr.name] = attr.options[0];\n                }\n              }\n            });\n          }\n          \n          setSelectedAttributes(defaultAttributes);\n          setSelectedVariation(highestPriceVariation);\n        }\n      }\n\n      // Cargar Advanced Product Fields si existen\n      await loadProductAddons();\n      \n    } catch (err) {\n      console.error('Error loading product data:', err);\n      setError('Error al cargar las opciones del producto. Por favor, intenta de nuevo.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadProductAddons = async () => {\n    // Verificar si el producto tiene campos adicionales del plugin Advanced Product Fields\n    if (product.meta_data) {\n      // Buscar el campo _wapf_fieldgroup\n      const fieldGroupData = product.meta_data.find(meta => meta.key === '_wapf_fieldgroup');\n      \n      if (fieldGroupData && fieldGroupData.value) {\n        // El valor puede ser un ID de grupo o un array de IDs\n        let groupIds = [];\n        if (Array.isArray(fieldGroupData.value)) {\n          groupIds = fieldGroupData.value;\n        } else if (typeof fieldGroupData.value === 'object' && fieldGroupData.value.groups) {\n          groupIds = fieldGroupData.value.groups;\n        } else if (typeof fieldGroupData.value === 'string' || typeof fieldGroupData.value === 'number') {\n          groupIds = [fieldGroupData.value];\n        }\n        \n        // Si tenemos IDs de grupos, necesitamos obtener los campos de esos grupos\n        // Por ahora, vamos a buscar si hay campos directamente en el producto\n        const possibleFieldKeys = [\n          '_wapf_fields',\n          '_wapf_field_groups_fields',\n          'wapf_fields',\n          '_product_addons'\n        ];\n        \n        for (const key of possibleFieldKeys) {\n          const fieldsData = product.meta_data.find(meta => meta.key === key);\n          if (fieldsData && fieldsData.value) {\n            const fields = Array.isArray(fieldsData.value) ? fieldsData.value : [fieldsData.value];\n            setProductAddons(fields);\n            initializeAddonValues(fields);\n            return;\n          }\n        }\n        \n        // Si no encontramos los campos compilados, intentamos obtenerlos via API personalizada\n        if (groupIds.length > 0 || true) { // Siempre intentar con la API personalizada\n          try {\n            // Construir la URL completa\n            const apiUrl = `https://escandalosospizzas.cl/wp/wp-json/custom/v1/product-fields/${product.id}`;\n            \n            const response = await fetch(apiUrl);\n            \n            if (response.ok) {\n              const data = await response.json();\n              \n              // Intentar diferentes estructuras de respuesta\n              let fields = null;\n              \n              // ESTRUCTURA ESPECÍFICA DE WAPF (Advanced Product Fields)\n              if (data && data.field_groups && data.field_groups.fields) {\n                fields = data.field_groups.fields;\n              }\n              // Si la respuesta es un array directo\n              else if (Array.isArray(data)) {\n                fields = data;\n              }\n              // Si los campos están en data.fields\n              else if (data && data.fields && Array.isArray(data.fields)) {\n                fields = data.fields;\n              }\n              // Si los campos están en data.data\n              else if (data && data.data) {\n                fields = data.data;\n              }\n              // Si la respuesta tiene una propiedad items\n              else if (data && data.items) {\n                fields = data.items;\n              }\n              // Si la respuesta tiene una propiedad addons\n              else if (data && data.addons) {\n                fields = data.addons;\n              }\n              // Si la respuesta tiene una propiedad product_fields\n              else if (data && data.product_fields) {\n                fields = data.product_fields;\n              }\n              // Si la respuesta es un objeto con campos como propiedades\n              else if (data && typeof data === 'object' && !Array.isArray(data)) {\n                // Buscar cualquier propiedad que sea un array\n                const keys = Object.keys(data);\n                for (const key of keys) {\n                  if (Array.isArray(data[key])) {\n                    fields = data[key];\n                    break;\n                  }\n                }\n                \n                // Si no encontramos arrays, tal vez los campos están directamente en el objeto\n                if (!fields && keys.length > 0) {\n                  // Verificar si el objeto tiene estructura de campo\n                  const firstKey = keys[0];\n                  if (data[firstKey] && (data[firstKey].type || data[firstKey].label || data[firstKey].name)) {\n                    // Convertir el objeto en array\n                    fields = Object.values(data);\n                  }\n                }\n              }\n              \n              if (fields) {\n                setProductAddons(fields);\n                initializeAddonValues(fields);\n              }\n            }\n          } catch (error) {\n            console.error('Error obteniendo campos via API:', error);\n          }\n        }\n      }\n    }\n    \n    // Si no encontramos campos via meta_data, verificar si están directamente en el producto\n    if (product.product_fields) {\n      setProductAddons(product.product_fields);\n      initializeAddonValues(product.product_fields);\n    } else if (product.addons) {\n      setProductAddons(product.addons);\n      initializeAddonValues(product.addons);\n    }\n  };\n\n  const initializeAddonValues = (fields) => {\n    const defaultValues = {};\n    fields.forEach(field => {\n      const fieldId = field.id || field.name || field.field_id;\n      \n      if (field.type === 'checkbox' || field.type === 'checkboxes' || field.type === 'multiple_choice') {\n        defaultValues[fieldId] = [];\n      } else if (field.type === 'number' && field.min !== undefined) {\n        defaultValues[fieldId] = field.min;\n      } else if (field.type === 'true_false') {\n        defaultValues[fieldId] = false;\n      } else if (field.type === 'radio' || field.type === 'radiobutton') {\n        // Para radio buttons, buscar si hay una opción seleccionada por defecto\n        const choices = field.options?.choices || field.options || [];\n        const defaultChoice = choices.find(choice => choice.selected === true);\n        defaultValues[fieldId] = defaultChoice ? (defaultChoice.label || defaultChoice.value) : '';\n      } else {\n        defaultValues[fieldId] = '';\n      }\n    });\n    setAddonValues(defaultValues);\n  };\n\n  const handleAttributeChange = useCallback((attributeName, value) => {\n    setSelectedAttributes(prev => {\n      const newAttributes = {\n        ...prev,\n        [attributeName]: value\n      };\n      \n      // Buscar variación que coincida en el siguiente render\n      setTimeout(() => findMatchingVariation(newAttributes), 0);\n      \n      return newAttributes;\n    });\n  }, [variations]);\n\n  const findMatchingVariation = useCallback((attributes) => {\n    if (!variations || variations.length === 0) return;\n    \n    const matching = variations.find(variation => {\n      return variation.attributes.every(attr => {\n        // Normalizar nombres de atributos\n        const normalizedAttrName = attr.name.toLowerCase().replace(/-/g, ' ');\n        const selectedValue = attributes[attr.name] || attributes[normalizedAttrName];\n        \n        // Comparar valores normalizados también\n        const normalizedOption = attr.option.toLowerCase();\n        const normalizedSelected = selectedValue?.toLowerCase();\n        \n        return normalizedOption === normalizedSelected || selectedValue == attr.option;\n      });\n    });\n    \n    setSelectedVariation(matching || null);\n  }, [variations]);\n\n  const handleAddonChange = useCallback((fieldId, value) => {\n    setAddonValues(prev => ({\n      ...prev,\n      [fieldId]: value\n    }));\n  }, []);\n\n  const handleFileUpload = useCallback((fieldId, file) => {\n    if (file) {\n      setAddonFiles(prev => ({\n        ...prev,\n        [fieldId]: file\n      }));\n      setAddonValues(prev => ({\n        ...prev,\n        [fieldId]: file.name\n      }));\n    }\n  }, []);\n\n  // Memorizar el cálculo del precio de addons\n  const addonPrice = useMemo(() => {\n    let addonTotal = 0;\n    \n    productAddons.forEach(addon => {\n      const fieldId = addon.id || addon.name;\n      const value = addonValues[fieldId];\n      \n      if (!value || (Array.isArray(value) && value.length === 0)) return;\n      \n      // Para WAPF, el precio puede estar en addon.pricing\n      if (addon.pricing && addon.pricing.enabled && addon.pricing.amount) {\n        if (addon.pricing.type === 'fixed') {\n          addonTotal += parseFloat(addon.pricing.amount);\n        } else if (addon.pricing.type === 'quantity_based') {\n          addonTotal += parseFloat(addon.pricing.amount) * quantity;\n        }\n      }\n      \n      // Precio fijo tradicional\n      else if (addon.price_type === 'flat_fee' && addon.price) {\n        addonTotal += parseFloat(addon.price);\n      }\n      \n      // Precio basado en cantidad\n      else if (addon.price_type === 'quantity_based' && addon.price) {\n        addonTotal += parseFloat(addon.price) * quantity;\n      }\n      \n      // Precio por carácter (para campos de texto)\n      else if (addon.price_type === 'per_char' && addon.price && typeof value === 'string') {\n        addonTotal += parseFloat(addon.price) * value.length;\n      }\n      \n      // Para campos con opciones (radio, select, checkbox)\n      else if ((addon.options?.choices || addon.options) && Array.isArray(addon.options?.choices || addon.options)) {\n        const options = addon.options?.choices || addon.options;\n        options.forEach(option => {\n          const isSelected = Array.isArray(value) \n            ? value.includes(option.label || option.value)\n            : value === (option.label || option.value);\n            \n          if (isSelected && (option.pricing_amount || option.price)) {\n            const optionPrice = option.pricing_amount || option.price;\n            if (option.pricing_type === 'quantity_based' || option.price_type === 'quantity_based') {\n              addonTotal += parseFloat(optionPrice) * quantity;\n            } else {\n              addonTotal += parseFloat(optionPrice);\n            }\n          }\n        });\n      }\n    });\n    \n    return addonTotal;\n  }, [productAddons, addonValues, quantity]);\n\n  // Memorizar el precio total\n  const totalPrice = useMemo(() => {\n    let basePrice = 0;\n    \n    if (selectedVariation && selectedVariation.price) {\n      basePrice = parseFloat(selectedVariation.price);\n    } else if (product && product.price) {\n      basePrice = parseFloat(product.price);\n    }\n    \n    return (basePrice + addonPrice) * quantity;\n  }, [selectedVariation, product, addonPrice, quantity]);\n\n  const formatPrice = (price) => {\n    return new Intl.NumberFormat('es-CL', {\n      style: 'currency',\n      currency: 'CLP',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(price);\n  };\n\n  const isValidSelection = () => {\n    if (product.type === 'variable') {\n      // Para productos variables, verificar que se haya seleccionado una variación válida\n      if (!selectedVariation || selectedVariation.stock_status === 'outofstock') {\n        return false;\n      }\n    }\n    \n    // Validar campos requeridos de Advanced Product Fields\n    for (const addon of productAddons) {\n      if (addon.required) {\n        const fieldId = addon.id || addon.name;\n        const value = addonValues[fieldId];\n        \n        if (!value || (Array.isArray(value) && value.length === 0)) {\n          setError(`Por favor, completa el campo: ${addon.title || addon.name}`);\n          return false;\n        }\n      }\n    }\n    \n    return true;\n  };\n\n  const handleAddToCart = async () => {\n    if (!isValidSelection()) {\n      if (!error) {\n        setError('Por favor, selecciona todas las opciones requeridas');\n      }\n      return;\n    }\n\n    setAddingToCart(true);\n\n    try {\n      // Preparar meta_data para Advanced Product Fields\n      const addonMetaData = [];\n      \n      productAddons.forEach(addon => {\n        const fieldId = addon.id || addon.name;\n        const value = addonValues[fieldId];\n        \n        if (value && !(Array.isArray(value) && value.length === 0)) {\n          // Calcular el precio del addon\n          let addonPrice = 0;\n          let priceType = 'flat_fee';\n          \n          // Para WAPF, el precio puede estar en addon.pricing\n          if (addon.pricing && addon.pricing.enabled && addon.pricing.amount) {\n            addonPrice = parseFloat(addon.pricing.amount);\n            priceType = addon.pricing.type || 'fixed';\n          }\n          // Precio tradicional\n          else if (addon.price) {\n            addonPrice = parseFloat(addon.price);\n            priceType = addon.price_type || 'flat_fee';\n          }\n          \n          // Para campos con opciones, buscar el precio de la opción seleccionada\n          if ((addon.options?.choices || addon.options) && Array.isArray(addon.options?.choices || addon.options)) {\n            const options = addon.options?.choices || addon.options;\n            options.forEach(option => {\n              const isSelected = Array.isArray(value) \n                ? value.includes(option.label || option.value)\n                : value === (option.label || option.value);\n                \n              if (isSelected && (option.pricing_amount || option.price)) {\n                addonPrice = parseFloat(option.pricing_amount || option.price);\n                priceType = option.pricing_type || option.price_type || 'flat_fee';\n              }\n            });\n          }\n          \n          // Agregar el campo a meta_data\n          addonMetaData.push({\n            key: addon.name || addon.title,\n            value: Array.isArray(value) ? value.join(', ') : value,\n            display: addon.title || addon.name,\n            price: addonPrice,\n            price_type: priceType\n          });\n        }\n      });\n\n      const cartItem = {\n        id: selectedVariation ? `${product.id}-${selectedVariation.id}-${Date.now()}` : `${product.id}-${Date.now()}`,\n        productId: product.id,\n        variationId: selectedVariation?.id,\n        name: product.name,\n        price: totalPrice / quantity, // Precio unitario incluyendo addons\n        image: selectedVariation?.image?.src || product.images?.[0]?.src || '',\n        quantity,\n        customizations: {\n          attributes: selectedAttributes,\n          specialInstructions: specialInstructions.trim(),\n          variationDetails: selectedVariation ? {\n            name: selectedVariation.name,\n            attributes: selectedVariation.attributes\n          } : null,\n          // Agregar datos de Advanced Product Fields\n          productAddons: addonMetaData,\n          addonValues: addonValues,\n          addonFiles: Object.keys(addonFiles).length > 0 ? addonFiles : null,\n          // Agregar el precio total de los addons\n          addonsPrice: addonPrice\n        }\n      };\n\n      addToCart(cartItem);\n      \n      // Mostrar mensaje de éxito\n      setTimeout(() => {\n        onClose();\n        resetForm();\n      }, 500);\n      \n    } catch (err) {\n      setError('Error al agregar al carrito. Por favor, intenta de nuevo.');\n    } finally {\n      setAddingToCart(false);\n    }\n  };\n\n  const renderAddonField = (addon) => {\n    const fieldId = addon.id || addon.name;\n    const value = addonValues[fieldId] || '';\n    \n    switch (addon.type) {\n      case 'text':\n      case 'custom_text':\n        return (\n          <input\n            type=\"text\"\n            value={value}\n            onChange={(e) => handleAddonChange(fieldId, e.target.value)}\n            placeholder={addon.placeholder || ''}\n            maxLength={addon.max || undefined}\n            className=\"addon-text-input\"\n            required={addon.required}\n          />\n        );\n        \n      case 'textarea':\n      case 'custom_textarea':\n        return (\n          <textarea\n            value={value}\n            onChange={(e) => handleAddonChange(fieldId, e.target.value)}\n            placeholder={addon.placeholder || ''}\n            maxLength={addon.max || undefined}\n            rows={4}\n            className=\"addon-textarea\"\n            required={addon.required}\n          />\n        );\n        \n      case 'number':\n        return (\n          <input\n            type=\"number\"\n            value={value}\n            onChange={(e) => handleAddonChange(fieldId, parseFloat(e.target.value) || 0)}\n            min={addon.min || undefined}\n            max={addon.max || undefined}\n            step={addon.step || 1}\n            className=\"addon-number-input\"\n            required={addon.required}\n          />\n        );\n        \n      case 'email':\n        return (\n          <input\n            type=\"email\"\n            value={value}\n            onChange={(e) => handleAddonChange(fieldId, e.target.value)}\n            placeholder={addon.placeholder || 'email@ejemplo.com'}\n            className=\"addon-email-input\"\n            required={addon.required}\n          />\n        );\n        \n      case 'select':\n      case 'dropdown':\n        const selectOptions = addon.options?.choices || addon.options || [];\n        return (\n          <select\n            value={value}\n            onChange={(e) => handleAddonChange(fieldId, e.target.value)}\n            className=\"addon-select\"\n            required={addon.required}\n          >\n            <option value=\"\">Selecciona una opción</option>\n            {selectOptions.map((option, index) => (\n              <option key={index} value={option.label || option.value}>\n                {option.label || option.value}\n                {(option.pricing_amount && option.pricing_amount > 0) && ` (+${formatPrice(option.pricing_amount)})`}\n              </option>\n            ))}\n          </select>\n        );\n        \n      case 'radio':\n      case 'radiobutton':\n        // Obtener las opciones correctamente según la estructura de WAPF\n        const radioOptions = addon.options?.choices || addon.options || [];\n        return (\n          <div className=\"addon-radio-group\">\n            {radioOptions.map((option, index) => (\n              <label key={index} className=\"addon-radio-option\">\n                <input\n                  type=\"radio\"\n                  name={fieldId}\n                  value={option.label || option.value}\n                  checked={value === (option.label || option.value)}\n                  onChange={(e) => handleAddonChange(fieldId, e.target.value)}\n                  required={addon.required}\n                />\n                <span className=\"radio-label\">\n                  {option.label || option.value}\n                  {(option.pricing_amount && option.pricing_amount > 0) && ` (+${formatPrice(option.pricing_amount)})`}\n                </span>\n              </label>\n            ))}\n          </div>\n        );\n        \n      case 'checkbox':\n      case 'checkboxes':\n      case 'multiple_choice':\n        const checkboxOptions = addon.options?.choices || addon.options || [];\n        return (\n          <div className=\"addon-checkbox-group\">\n            {checkboxOptions.map((option, index) => (\n              <label key={index} className=\"addon-checkbox-option\">\n                <input\n                  type=\"checkbox\"\n                  value={option.label || option.value}\n                  checked={Array.isArray(value) && value.includes(option.label || option.value)}\n                  onChange={(e) => {\n                    const optionValue = option.label || option.value;\n                    const currentValues = Array.isArray(value) ? value : [];\n                    \n                    if (e.target.checked) {\n                      handleAddonChange(fieldId, [...currentValues, optionValue]);\n                    } else {\n                      handleAddonChange(fieldId, currentValues.filter(v => v !== optionValue));\n                    }\n                  }}\n                />\n                <span className=\"checkbox-label\">\n                  {option.label || option.value}\n                  {(option.pricing_amount && option.pricing_amount > 0) && ` (+${formatPrice(option.pricing_amount)})`}\n                </span>\n              </label>\n            ))}\n          </div>\n        );\n        \n      case 'file':\n      case 'file_upload':\n        return (\n          <div className=\"addon-file-upload\">\n            <label className=\"file-upload-label\">\n              <input\n                type=\"file\"\n                onChange={(e) => handleFileUpload(fieldId, e.target.files[0])}\n                accept={addon.allowed_types || '*'}\n                required={addon.required}\n                className=\"file-input\"\n              />\n              <span className=\"file-upload-button\">\n                <Upload size={16} />\n                {addonFiles[fieldId] ? addonFiles[fieldId].name : 'Seleccionar archivo'}\n              </span>\n            </label>\n            {addon.max_size && (\n              <p className=\"file-size-info\">\n                Tamaño máximo: {addon.max_size}MB\n              </p>\n            )}\n          </div>\n        );\n        \n      case 'color':\n        return (\n          <input\n            type=\"color\"\n            value={value || '#000000'}\n            onChange={(e) => handleAddonChange(fieldId, e.target.value)}\n            className=\"addon-color-input\"\n            required={addon.required}\n          />\n        );\n        \n      case 'date':\n        return (\n          <input\n            type=\"date\"\n            value={value}\n            onChange={(e) => handleAddonChange(fieldId, e.target.value)}\n            min={addon.min_date || undefined}\n            max={addon.max_date || undefined}\n            className=\"addon-date-input\"\n            required={addon.required}\n          />\n        );\n        \n      case 'true_false':\n        return (\n          <label className=\"addon-checkbox-option\">\n            <input\n              type=\"checkbox\"\n              checked={value === true}\n              onChange={(e) => handleAddonChange(fieldId, e.target.checked)}\n              required={addon.required}\n            />\n            <span className=\"checkbox-label\">\n              {addon.true_label || 'Sí'}\n            </span>\n          </label>\n        );\n        \n      default:\n        return null;\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"customization-modal-overlay\" onClick={onClose}>\n      <div className=\"customization-modal\" onClick={(e) => e.stopPropagation()}>\n        <button className=\"modal-close\" onClick={onClose}>\n          <X size={24} />\n        </button>\n        \n        <h2>Personalizar Pedido</h2>\n        \n        {loading ? (\n          <div className=\"loading-container\">\n            <Loader className=\"loading-spinner\" size={48} />\n            <p>Cargando opciones...</p>\n          </div>\n        ) : error ? (\n          <div className=\"error-container\">\n            <p className=\"error-message\">{error}</p>\n            <button onClick={loadProductData} className=\"retry-button\">\n              Reintentar\n            </button>\n          </div>\n        ) : (\n          <>\n            {/* Información del producto */}\n            <div className=\"customization-product-info\">\n              {product.images && product.images[0] ? (\n                <img \n                  src={product.images[0].src} \n                  alt={product.name} \n                  className=\"customization-product-image\"\n                />\n              ) : (\n                <div className=\"customization-product-image placeholder\">\n                  <Pizza size={48} />\n                </div>\n              )}\n              <div className=\"product-details\">\n                <h3>{product.name}</h3>\n                {/* Mostrar descripción corta si está disponible */}\n                {product.short_description && (\n                  <p className=\"product-description\" \n                     dangerouslySetInnerHTML={{ __html: product.short_description }} />\n                )}\n                {/* Si no hay descripción corta, mostrar la descripción normal completa */}\n                {!product.short_description && product.description && (\n                  <p className=\"product-description\" \n                     dangerouslySetInnerHTML={{ __html: product.description }} />\n                )}\n                {/* Mostrar precio actual */}\n                <div className=\"header-price\">\n                  <span className=\"price-label\">Precio: </span>\n                  <span className=\"price-value\">{formatPrice(totalPrice / quantity)}</span>\n                  {selectedVariation && selectedVariation.attributes && (\n                    <span className=\"price-variant\"> - {selectedVariation.attributes.map(attr => attr.option).join(', ')}</span>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            {/* Atributos de variación */}\n            {attributes.length > 0 && (\n              <div className=\"customization-section\">\n                {attributes.map(attribute => (\n                  <div key={attribute.id || attribute.name} className=\"attribute-section\">\n                    <h4>{attribute.name}</h4>\n                    {attribute.description && (\n                      <p className=\"section-description\">{attribute.description}</p>\n                    )}\n                    <div className=\"attribute-options\">\n                      {attribute.options\n                        .sort((a, b) => {\n                          // Si es el atributo de tamaño, ordenar para que Familiar aparezca primero\n                          if (attribute.name.toLowerCase() === 'tamaño' || attribute.name.toLowerCase() === 'tamano') {\n                            if (a.toLowerCase() === 'familiar') return -1;\n                            if (b.toLowerCase() === 'familiar') return 1;\n                          }\n                          return 0;\n                        })\n                        .map(option => (\n                        <label key={option} className=\"attribute-option\">\n                          <input\n                            type=\"radio\"\n                            name={attribute.name}\n                            value={option}\n                            checked={selectedAttributes[attribute.name] === option}\n                            onChange={() => handleAttributeChange(attribute.name, option)}\n                          />\n                          <span className=\"option-label\">\n                            <span className=\"option-check\">\n                              <Check size={16} />\n                            </span>\n                            {option}\n                          </span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* Advanced Product Fields */}\n            {productAddons.length > 0 && (\n              <div className=\"customization-section\">\n                <h4>Opciones adicionales</h4>\n                {productAddons.map((addon, index) => (\n                  <div key={addon.id || addon.name || index} className=\"addon-field\">\n                    <label className=\"addon-label\">\n                      {addon.label || addon.title || addon.name || 'Campo adicional'}\n                      {addon.required && <span className=\"required\">*</span>}\n                      {(addon.pricing?.enabled && addon.pricing?.amount > 0) && (\n                        <span className=\"addon-price\">\n                          {addon.pricing.type === 'quantity_based' \n                            ? ` (+${formatPrice(addon.pricing.amount)} por unidad)`\n                            : ` (+${formatPrice(addon.pricing.amount)})`\n                          }\n                        </span>\n                      )}\n                    </label>\n                    {addon.description && (\n                      <p className=\"addon-description\">{addon.description}</p>\n                    )}\n                    {renderAddonField(addon)}\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* Mostrar información de la variación seleccionada */}\n            {selectedVariation && (selectedVariation.stock_status === 'outofstock' || \n              (selectedVariation.stock_quantity && selectedVariation.stock_quantity < 10)) && (\n              <div className=\"variation-info\">\n                <div className=\"variation-details\">\n                  {selectedVariation.stock_status === 'outofstock' ? (\n                    <p className=\"out-of-stock\">⚠️ Producto agotado</p>\n                  ) : selectedVariation.stock_quantity && selectedVariation.stock_quantity < 10 ? (\n                    <p className=\"low-stock\">⚡ Últimas {selectedVariation.stock_quantity} unidades</p>\n                  ) : null}\n                </div>\n              </div>\n            )}\n\n            {/* Instrucciones especiales */}\n            <div className=\"customization-section\">\n              <h4>Instrucciones especiales (opcional)</h4>\n              <p className=\"section-description\">\n                ¿Alguna preferencia especial?\n              </p>\n              <textarea\n                className=\"special-instructions\"\n                value={specialInstructions}\n                onChange={(e) => setSpecialInstructions(e.target.value)}\n                placeholder=\"Ej: Sin cebolla, extra queso, etc.\"\n                rows={3}\n              />\n            </div>\n\n            {/* Cantidad y precio */}\n            <div className=\"quantity-price-section\">\n              <div className=\"quantity-selector\">\n                <h4>Cantidad</h4>\n                <div className=\"quantity-controls\">\n                  <button \n                    onClick={() => setQuantity(Math.max(1, quantity - 1))}\n                    disabled={quantity <= 1}\n                  >\n                    <Minus size={20} />\n                  </button>\n                  <span className=\"quantity-value\">{quantity}</span>\n                  <button \n                    onClick={() => setQuantity(quantity + 1)}\n                    disabled={selectedVariation?.stock_status === 'outofstock'}\n                  >\n                    <Plus size={20} />\n                  </button>\n                </div>\n              </div>\n              \n              <div className=\"price-info\">\n                <h4>Total</h4>\n                <p className=\"total-price\">{formatPrice(totalPrice)}</p>\n              </div>\n            </div>\n\n            {/* Botón agregar al carrito */}\n            <button \n              className={`add-to-cart-button ${addingToCart ? 'loading' : ''}`}\n              onClick={handleAddToCart}\n              disabled={addingToCart || (selectedVariation?.stock_status === 'outofstock')}\n            >\n              {addingToCart ? (\n                <>\n                  <Loader className=\"button-spinner\" size={20} />\n                  Agregando...\n                </>\n              ) : (\n                <>\n                  <ShoppingCart size={20} />\n                  Agregar al Carrito\n                </>\n              )}\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CustomizationModal;"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,UAAU,CAAEC,SAAS,CAAEC,WAAW,CAAEC,OAAO,KAAQ,OAAO,CACpF,OAASC,CAAC,CAAEC,IAAI,CAAEC,KAAK,CAAEC,IAAI,CAAEC,KAAK,CAAEC,MAAM,CAAEC,KAAK,CAAEC,MAAM,CAAEC,YAAY,KAAQ,cAAc,CAC/F,OAASC,WAAW,KAAQ,2BAA2B,CACvD,MAAO,CAAAC,cAAc,KAAM,+BAA+B,CAC1D,MAAO,0BAA0B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAElC,KAAM,CAAAC,kBAAkB,CAAGC,IAAA,EAAkC,IAAjC,CAAEC,OAAO,CAAEC,MAAM,CAAEC,OAAQ,CAAC,CAAAH,IAAA,CACtD,KAAM,CAAEI,SAAU,CAAC,CAAG1B,UAAU,CAACa,WAAW,CAAC,CAE7C;AACA,KAAM,CAACc,UAAU,CAAEC,aAAa,CAAC,CAAG7B,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC8B,UAAU,CAAEC,aAAa,CAAC,CAAG/B,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACgC,OAAO,CAAEC,UAAU,CAAC,CAAGjC,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACkC,KAAK,CAAEC,QAAQ,CAAC,CAAGnC,QAAQ,CAAC,IAAI,CAAC,CAExC;AACA,KAAM,CAACoC,aAAa,CAAEC,gBAAgB,CAAC,CAAGrC,QAAQ,CAAC,EAAE,CAAC,CACtD,KAAM,CAACsC,WAAW,CAAEC,cAAc,CAAC,CAAGvC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAClD,KAAM,CAACwC,UAAU,CAAEC,aAAa,CAAC,CAAGzC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAEhD;AACA,KAAM,CAAC0C,kBAAkB,CAAEC,qBAAqB,CAAC,CAAG3C,QAAQ,CAAC,CAAC,CAAC,CAAC,CAChE,KAAM,CAAC4C,iBAAiB,CAAEC,oBAAoB,CAAC,CAAG7C,QAAQ,CAAC,IAAI,CAAC,CAChE,KAAM,CAAC8C,QAAQ,CAAEC,WAAW,CAAC,CAAG/C,QAAQ,CAAC,CAAC,CAAC,CAC3C,KAAM,CAACgD,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGjD,QAAQ,CAAC,EAAE,CAAC,CAClE,KAAM,CAACkD,YAAY,CAAEC,eAAe,CAAC,CAAGnD,QAAQ,CAAC,KAAK,CAAC,CAEvD;AACAE,SAAS,CAAC,IAAM,CACd,GAAIuB,MAAM,EAAID,OAAO,CAAE,CACrB4B,SAAS,CAAC,CAAC,CACXC,eAAe,CAAC,CAAC,CACnB,CACF,CAAC,CAAE,CAAC5B,MAAM,CAAED,OAAO,CAAC,CAAC,CAErB,KAAM,CAAA4B,SAAS,CAAGA,CAAA,GAAM,CACtBT,qBAAqB,CAAC,CAAC,CAAC,CAAC,CACzBE,oBAAoB,CAAC,IAAI,CAAC,CAC1BE,WAAW,CAAC,CAAC,CAAC,CACdE,sBAAsB,CAAC,EAAE,CAAC,CAC1BZ,gBAAgB,CAAC,EAAE,CAAC,CACpBE,cAAc,CAAC,CAAC,CAAC,CAAC,CAClBE,aAAa,CAAC,CAAC,CAAC,CAAC,CACjBN,QAAQ,CAAC,IAAI,CAAC,CAChB,CAAC,CAED,KAAM,CAAAkB,eAAe,CAAG,KAAAA,CAAA,GAAY,CAClCpB,UAAU,CAAC,IAAI,CAAC,CAChBE,QAAQ,CAAC,IAAI,CAAC,CAEd,GAAI,CACF;AACA,GAAIX,OAAO,CAAC8B,IAAI,GAAK,UAAU,CAAE,CAC/B,KAAM,CAAAC,cAAc,CAAG,KAAM,CAAAxC,cAAc,CAACyC,oBAAoB,CAAChC,OAAO,CAACiC,EAAE,CAAC,CAC5E5B,aAAa,CAAC0B,cAAc,EAAI,EAAE,CAAC,CAEnC;AACA,GAAI/B,OAAO,CAACM,UAAU,CAAE,CACtB,KAAM,CAAA4B,kBAAkB,CAAGlC,OAAO,CAACM,UAAU,CAAC6B,MAAM,CAACC,IAAI,EAAIA,IAAI,CAACC,SAAS,CAAC,CAC5E9B,aAAa,CAAC2B,kBAAkB,CAAC,CAEjC;AACA,KAAM,CAAAI,qBAAqB,CAAGP,cAAc,CAACQ,MAAM,CAAC,CAACC,IAAI,CAAEC,OAAO,GAAK,CACrE,KAAM,CAAAC,SAAS,CAAGC,UAAU,CAACH,IAAI,CAACI,KAAK,CAAC,EAAI,CAAC,CAC7C,KAAM,CAAAC,YAAY,CAAGF,UAAU,CAACF,OAAO,CAACG,KAAK,CAAC,EAAI,CAAC,CACnD,MAAO,CAAAC,YAAY,CAAGH,SAAS,CAAGD,OAAO,CAAGD,IAAI,CAClD,CAAC,CAAET,cAAc,CAAC,CAAC,CAAC,CAAC,CAErB;AACA,KAAM,CAAAe,iBAAiB,CAAG,CAAC,CAAC,CAC5B,GAAIR,qBAAqB,EAAIA,qBAAqB,CAAChC,UAAU,CAAE,CAC7DgC,qBAAqB,CAAChC,UAAU,CAACyC,OAAO,CAACC,OAAO,EAAI,CAClD;AACA,KAAM,CAAAC,WAAW,CAAGf,kBAAkB,CAACgB,IAAI,CAACd,IAAI,EAC9CA,IAAI,CAACe,IAAI,GAAKH,OAAO,CAACG,IAAI,EAC1Bf,IAAI,CAACe,IAAI,CAACC,WAAW,CAAC,CAAC,GAAKJ,OAAO,CAACG,IAAI,CAACC,WAAW,CAAC,CACvD,CAAC,CAED,GAAIH,WAAW,CAAE,CACfH,iBAAiB,CAACG,WAAW,CAACE,IAAI,CAAC,CAAGH,OAAO,CAACK,MAAM,CACtD,CACF,CAAC,CAAC,CACJ,CAAC,IAAM,CACL;AACAnB,kBAAkB,CAACa,OAAO,CAACX,IAAI,EAAI,CACjC,GAAIA,IAAI,CAACkB,OAAO,EAAIlB,IAAI,CAACkB,OAAO,CAACC,MAAM,CAAG,CAAC,CAAE,CAC3C;AACA,GAAInB,IAAI,CAACe,IAAI,CAACC,WAAW,CAAC,CAAC,GAAK,QAAQ,EAAIhB,IAAI,CAACe,IAAI,CAACC,WAAW,CAAC,CAAC,GAAK,QAAQ,CAAE,CAChF,KAAM,CAAAI,cAAc,CAAGpB,IAAI,CAACkB,OAAO,CAACJ,IAAI,CAACO,GAAG,EAC1CA,GAAG,CAACL,WAAW,CAAC,CAAC,GAAK,UACxB,CAAC,CACDN,iBAAiB,CAACV,IAAI,CAACe,IAAI,CAAC,CAAGK,cAAc,EAAIpB,IAAI,CAACkB,OAAO,CAAC,CAAC,CAAC,CAClE,CAAC,IAAM,CACLR,iBAAiB,CAACV,IAAI,CAACe,IAAI,CAAC,CAAGf,IAAI,CAACkB,OAAO,CAAC,CAAC,CAAC,CAChD,CACF,CACF,CAAC,CAAC,CACJ,CAEAnC,qBAAqB,CAAC2B,iBAAiB,CAAC,CACxCzB,oBAAoB,CAACiB,qBAAqB,CAAC,CAC7C,CACF,CAEA;AACA,KAAM,CAAAoB,iBAAiB,CAAC,CAAC,CAE3B,CAAE,MAAOC,GAAG,CAAE,CACZC,OAAO,CAAClD,KAAK,CAAC,6BAA6B,CAAEiD,GAAG,CAAC,CACjDhD,QAAQ,CAAC,yEAAyE,CAAC,CACrF,CAAC,OAAS,CACRF,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAAiD,iBAAiB,CAAG,KAAAA,CAAA,GAAY,CACpC;AACA,GAAI1D,OAAO,CAAC6D,SAAS,CAAE,CACrB;AACA,KAAM,CAAAC,cAAc,CAAG9D,OAAO,CAAC6D,SAAS,CAACX,IAAI,CAACa,IAAI,EAAIA,IAAI,CAACC,GAAG,GAAK,kBAAkB,CAAC,CAEtF,GAAIF,cAAc,EAAIA,cAAc,CAACG,KAAK,CAAE,CAC1C;AACA,GAAI,CAAAC,QAAQ,CAAG,EAAE,CACjB,GAAIC,KAAK,CAACC,OAAO,CAACN,cAAc,CAACG,KAAK,CAAC,CAAE,CACvCC,QAAQ,CAAGJ,cAAc,CAACG,KAAK,CACjC,CAAC,IAAM,IAAI,MAAO,CAAAH,cAAc,CAACG,KAAK,GAAK,QAAQ,EAAIH,cAAc,CAACG,KAAK,CAACI,MAAM,CAAE,CAClFH,QAAQ,CAAGJ,cAAc,CAACG,KAAK,CAACI,MAAM,CACxC,CAAC,IAAM,IAAI,MAAO,CAAAP,cAAc,CAACG,KAAK,GAAK,QAAQ,EAAI,MAAO,CAAAH,cAAc,CAACG,KAAK,GAAK,QAAQ,CAAE,CAC/FC,QAAQ,CAAG,CAACJ,cAAc,CAACG,KAAK,CAAC,CACnC,CAEA;AACA;AACA,KAAM,CAAAK,iBAAiB,CAAG,CACxB,cAAc,CACd,2BAA2B,CAC3B,aAAa,CACb,iBAAiB,CAClB,CAED,IAAK,KAAM,CAAAN,GAAG,GAAI,CAAAM,iBAAiB,CAAE,CACnC,KAAM,CAAAC,UAAU,CAAGvE,OAAO,CAAC6D,SAAS,CAACX,IAAI,CAACa,IAAI,EAAIA,IAAI,CAACC,GAAG,GAAKA,GAAG,CAAC,CACnE,GAAIO,UAAU,EAAIA,UAAU,CAACN,KAAK,CAAE,CAClC,KAAM,CAAAO,MAAM,CAAGL,KAAK,CAACC,OAAO,CAACG,UAAU,CAACN,KAAK,CAAC,CAAGM,UAAU,CAACN,KAAK,CAAG,CAACM,UAAU,CAACN,KAAK,CAAC,CACtFpD,gBAAgB,CAAC2D,MAAM,CAAC,CACxBC,qBAAqB,CAACD,MAAM,CAAC,CAC7B,OACF,CACF,CAEA;AACA,GAAIN,QAAQ,CAACX,MAAM,CAAG,CAAC,EAAI,IAAI,CAAE,CAAE;AACjC,GAAI,CACF;AACA,KAAM,CAAAmB,MAAM,CAAG,qEAAqE1E,OAAO,CAACiC,EAAE,EAAE,CAEhG,KAAM,CAAA0C,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACF,MAAM,CAAC,CAEpC,GAAIC,QAAQ,CAACE,EAAE,CAAE,CACf,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAH,QAAQ,CAACI,IAAI,CAAC,CAAC,CAElC;AACA,GAAI,CAAAP,MAAM,CAAG,IAAI,CAEjB;AACA,GAAIM,IAAI,EAAIA,IAAI,CAACE,YAAY,EAAIF,IAAI,CAACE,YAAY,CAACR,MAAM,CAAE,CACzDA,MAAM,CAAGM,IAAI,CAACE,YAAY,CAACR,MAAM,CACnC,CACA;AAAA,IACK,IAAIL,KAAK,CAACC,OAAO,CAACU,IAAI,CAAC,CAAE,CAC5BN,MAAM,CAAGM,IAAI,CACf,CACA;AAAA,IACK,IAAIA,IAAI,EAAIA,IAAI,CAACN,MAAM,EAAIL,KAAK,CAACC,OAAO,CAACU,IAAI,CAACN,MAAM,CAAC,CAAE,CAC1DA,MAAM,CAAGM,IAAI,CAACN,MAAM,CACtB,CACA;AAAA,IACK,IAAIM,IAAI,EAAIA,IAAI,CAACA,IAAI,CAAE,CAC1BN,MAAM,CAAGM,IAAI,CAACA,IAAI,CACpB,CACA;AAAA,IACK,IAAIA,IAAI,EAAIA,IAAI,CAACG,KAAK,CAAE,CAC3BT,MAAM,CAAGM,IAAI,CAACG,KAAK,CACrB,CACA;AAAA,IACK,IAAIH,IAAI,EAAIA,IAAI,CAACI,MAAM,CAAE,CAC5BV,MAAM,CAAGM,IAAI,CAACI,MAAM,CACtB,CACA;AAAA,IACK,IAAIJ,IAAI,EAAIA,IAAI,CAACK,cAAc,CAAE,CACpCX,MAAM,CAAGM,IAAI,CAACK,cAAc,CAC9B,CACA;AAAA,IACK,IAAIL,IAAI,EAAI,MAAO,CAAAA,IAAI,GAAK,QAAQ,EAAI,CAACX,KAAK,CAACC,OAAO,CAACU,IAAI,CAAC,CAAE,CACjE;AACA,KAAM,CAAAM,IAAI,CAAGC,MAAM,CAACD,IAAI,CAACN,IAAI,CAAC,CAC9B,IAAK,KAAM,CAAAd,GAAG,GAAI,CAAAoB,IAAI,CAAE,CACtB,GAAIjB,KAAK,CAACC,OAAO,CAACU,IAAI,CAACd,GAAG,CAAC,CAAC,CAAE,CAC5BQ,MAAM,CAAGM,IAAI,CAACd,GAAG,CAAC,CAClB,MACF,CACF,CAEA;AACA,GAAI,CAACQ,MAAM,EAAIY,IAAI,CAAC7B,MAAM,CAAG,CAAC,CAAE,CAC9B;AACA,KAAM,CAAA+B,QAAQ,CAAGF,IAAI,CAAC,CAAC,CAAC,CACxB,GAAIN,IAAI,CAACQ,QAAQ,CAAC,GAAKR,IAAI,CAACQ,QAAQ,CAAC,CAACxD,IAAI,EAAIgD,IAAI,CAACQ,QAAQ,CAAC,CAACC,KAAK,EAAIT,IAAI,CAACQ,QAAQ,CAAC,CAACnC,IAAI,CAAC,CAAE,CAC1F;AACAqB,MAAM,CAAGa,MAAM,CAACG,MAAM,CAACV,IAAI,CAAC,CAC9B,CACF,CACF,CAEA,GAAIN,MAAM,CAAE,CACV3D,gBAAgB,CAAC2D,MAAM,CAAC,CACxBC,qBAAqB,CAACD,MAAM,CAAC,CAC/B,CACF,CACF,CAAE,MAAO9D,KAAK,CAAE,CACdkD,OAAO,CAAClD,KAAK,CAAC,kCAAkC,CAAEA,KAAK,CAAC,CAC1D,CACF,CACF,CACF,CAEA;AACA,GAAIV,OAAO,CAACmF,cAAc,CAAE,CAC1BtE,gBAAgB,CAACb,OAAO,CAACmF,cAAc,CAAC,CACxCV,qBAAqB,CAACzE,OAAO,CAACmF,cAAc,CAAC,CAC/C,CAAC,IAAM,IAAInF,OAAO,CAACkF,MAAM,CAAE,CACzBrE,gBAAgB,CAACb,OAAO,CAACkF,MAAM,CAAC,CAChCT,qBAAqB,CAACzE,OAAO,CAACkF,MAAM,CAAC,CACvC,CACF,CAAC,CAED,KAAM,CAAAT,qBAAqB,CAAID,MAAM,EAAK,CACxC,KAAM,CAAAiB,aAAa,CAAG,CAAC,CAAC,CACxBjB,MAAM,CAACzB,OAAO,CAAC2C,KAAK,EAAI,CACtB,KAAM,CAAAC,OAAO,CAAGD,KAAK,CAACzD,EAAE,EAAIyD,KAAK,CAACvC,IAAI,EAAIuC,KAAK,CAACE,QAAQ,CAExD,GAAIF,KAAK,CAAC5D,IAAI,GAAK,UAAU,EAAI4D,KAAK,CAAC5D,IAAI,GAAK,YAAY,EAAI4D,KAAK,CAAC5D,IAAI,GAAK,iBAAiB,CAAE,CAChG2D,aAAa,CAACE,OAAO,CAAC,CAAG,EAAE,CAC7B,CAAC,IAAM,IAAID,KAAK,CAAC5D,IAAI,GAAK,QAAQ,EAAI4D,KAAK,CAACG,GAAG,GAAKC,SAAS,CAAE,CAC7DL,aAAa,CAACE,OAAO,CAAC,CAAGD,KAAK,CAACG,GAAG,CACpC,CAAC,IAAM,IAAIH,KAAK,CAAC5D,IAAI,GAAK,YAAY,CAAE,CACtC2D,aAAa,CAACE,OAAO,CAAC,CAAG,KAAK,CAChC,CAAC,IAAM,IAAID,KAAK,CAAC5D,IAAI,GAAK,OAAO,EAAI4D,KAAK,CAAC5D,IAAI,GAAK,aAAa,CAAE,KAAAiE,cAAA,CACjE;AACA,KAAM,CAAAC,OAAO,CAAG,EAAAD,cAAA,CAAAL,KAAK,CAACpC,OAAO,UAAAyC,cAAA,iBAAbA,cAAA,CAAeC,OAAO,GAAIN,KAAK,CAACpC,OAAO,EAAI,EAAE,CAC7D,KAAM,CAAA2C,aAAa,CAAGD,OAAO,CAAC9C,IAAI,CAACgD,MAAM,EAAIA,MAAM,CAACC,QAAQ,GAAK,IAAI,CAAC,CACtEV,aAAa,CAACE,OAAO,CAAC,CAAGM,aAAa,CAAIA,aAAa,CAACV,KAAK,EAAIU,aAAa,CAAChC,KAAK,CAAI,EAAE,CAC5F,CAAC,IAAM,CACLwB,aAAa,CAACE,OAAO,CAAC,CAAG,EAAE,CAC7B,CACF,CAAC,CAAC,CACF5E,cAAc,CAAC0E,aAAa,CAAC,CAC/B,CAAC,CAED,KAAM,CAAAW,qBAAqB,CAAGzH,WAAW,CAAC,CAAC0H,aAAa,CAAEpC,KAAK,GAAK,CAClE9C,qBAAqB,CAACqB,IAAI,EAAI,CAC5B,KAAM,CAAA8D,aAAa,CAAG,CACpB,GAAG9D,IAAI,CACP,CAAC6D,aAAa,EAAGpC,KACnB,CAAC,CAED;AACAsC,UAAU,CAAC,IAAMC,qBAAqB,CAACF,aAAa,CAAC,CAAE,CAAC,CAAC,CAEzD,MAAO,CAAAA,aAAa,CACtB,CAAC,CAAC,CACJ,CAAC,CAAE,CAAClG,UAAU,CAAC,CAAC,CAEhB,KAAM,CAAAoG,qBAAqB,CAAG7H,WAAW,CAAE2B,UAAU,EAAK,CACxD,GAAI,CAACF,UAAU,EAAIA,UAAU,CAACmD,MAAM,GAAK,CAAC,CAAE,OAE5C,KAAM,CAAAkD,QAAQ,CAAGrG,UAAU,CAAC8C,IAAI,CAACb,SAAS,EAAI,CAC5C,MAAO,CAAAA,SAAS,CAAC/B,UAAU,CAACoG,KAAK,CAACtE,IAAI,EAAI,CACxC;AACA,KAAM,CAAAuE,kBAAkB,CAAGvE,IAAI,CAACe,IAAI,CAACC,WAAW,CAAC,CAAC,CAACwD,OAAO,CAAC,IAAI,CAAE,GAAG,CAAC,CACrE,KAAM,CAAAC,aAAa,CAAGvG,UAAU,CAAC8B,IAAI,CAACe,IAAI,CAAC,EAAI7C,UAAU,CAACqG,kBAAkB,CAAC,CAE7E;AACA,KAAM,CAAAG,gBAAgB,CAAG1E,IAAI,CAACiB,MAAM,CAACD,WAAW,CAAC,CAAC,CAClD,KAAM,CAAA2D,kBAAkB,CAAGF,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEzD,WAAW,CAAC,CAAC,CAEvD,MAAO,CAAA0D,gBAAgB,GAAKC,kBAAkB,EAAIF,aAAa,EAAIzE,IAAI,CAACiB,MAAM,CAChF,CAAC,CAAC,CACJ,CAAC,CAAC,CAEFhC,oBAAoB,CAACoF,QAAQ,EAAI,IAAI,CAAC,CACxC,CAAC,CAAE,CAACrG,UAAU,CAAC,CAAC,CAEhB,KAAM,CAAA4G,iBAAiB,CAAGrI,WAAW,CAAC,CAACgH,OAAO,CAAE1B,KAAK,GAAK,CACxDlD,cAAc,CAACyB,IAAI,GAAK,CACtB,GAAGA,IAAI,CACP,CAACmD,OAAO,EAAG1B,KACb,CAAC,CAAC,CAAC,CACL,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAgD,gBAAgB,CAAGtI,WAAW,CAAC,CAACgH,OAAO,CAAEuB,IAAI,GAAK,CACtD,GAAIA,IAAI,CAAE,CACRjG,aAAa,CAACuB,IAAI,GAAK,CACrB,GAAGA,IAAI,CACP,CAACmD,OAAO,EAAGuB,IACb,CAAC,CAAC,CAAC,CACHnG,cAAc,CAACyB,IAAI,GAAK,CACtB,GAAGA,IAAI,CACP,CAACmD,OAAO,EAAGuB,IAAI,CAAC/D,IAClB,CAAC,CAAC,CAAC,CACL,CACF,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAgE,UAAU,CAAGvI,OAAO,CAAC,IAAM,CAC/B,GAAI,CAAAwI,UAAU,CAAG,CAAC,CAElBxG,aAAa,CAACmC,OAAO,CAACsE,KAAK,EAAI,KAAAC,cAAA,CAAAC,eAAA,CAC7B,KAAM,CAAA5B,OAAO,CAAG0B,KAAK,CAACpF,EAAE,EAAIoF,KAAK,CAAClE,IAAI,CACtC,KAAM,CAAAc,KAAK,CAAGnD,WAAW,CAAC6E,OAAO,CAAC,CAElC,GAAI,CAAC1B,KAAK,EAAKE,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,EAAIA,KAAK,CAACV,MAAM,GAAK,CAAE,CAAE,OAE5D;AACA,GAAI8D,KAAK,CAACG,OAAO,EAAIH,KAAK,CAACG,OAAO,CAACC,OAAO,EAAIJ,KAAK,CAACG,OAAO,CAACE,MAAM,CAAE,CAClE,GAAIL,KAAK,CAACG,OAAO,CAAC1F,IAAI,GAAK,OAAO,CAAE,CAClCsF,UAAU,EAAIzE,UAAU,CAAC0E,KAAK,CAACG,OAAO,CAACE,MAAM,CAAC,CAChD,CAAC,IAAM,IAAIL,KAAK,CAACG,OAAO,CAAC1F,IAAI,GAAK,gBAAgB,CAAE,CAClDsF,UAAU,EAAIzE,UAAU,CAAC0E,KAAK,CAACG,OAAO,CAACE,MAAM,CAAC,CAAGpG,QAAQ,CAC3D,CACF,CAEA;AAAA,IACK,IAAI+F,KAAK,CAACM,UAAU,GAAK,UAAU,EAAIN,KAAK,CAACzE,KAAK,CAAE,CACvDwE,UAAU,EAAIzE,UAAU,CAAC0E,KAAK,CAACzE,KAAK,CAAC,CACvC,CAEA;AAAA,IACK,IAAIyE,KAAK,CAACM,UAAU,GAAK,gBAAgB,EAAIN,KAAK,CAACzE,KAAK,CAAE,CAC7DwE,UAAU,EAAIzE,UAAU,CAAC0E,KAAK,CAACzE,KAAK,CAAC,CAAGtB,QAAQ,CAClD,CAEA;AAAA,IACK,IAAI+F,KAAK,CAACM,UAAU,GAAK,UAAU,EAAIN,KAAK,CAACzE,KAAK,EAAI,MAAO,CAAAqB,KAAK,GAAK,QAAQ,CAAE,CACpFmD,UAAU,EAAIzE,UAAU,CAAC0E,KAAK,CAACzE,KAAK,CAAC,CAAGqB,KAAK,CAACV,MAAM,CACtD,CAEA;AAAA,IACK,IAAI,CAAC,CAAA+D,cAAA,CAAAD,KAAK,CAAC/D,OAAO,UAAAgE,cAAA,WAAbA,cAAA,CAAetB,OAAO,EAAIqB,KAAK,CAAC/D,OAAO,GAAKa,KAAK,CAACC,OAAO,CAAC,EAAAmD,eAAA,CAAAF,KAAK,CAAC/D,OAAO,UAAAiE,eAAA,iBAAbA,eAAA,CAAevB,OAAO,GAAIqB,KAAK,CAAC/D,OAAO,CAAC,CAAE,KAAAsE,eAAA,CAC5G,KAAM,CAAAtE,OAAO,CAAG,EAAAsE,eAAA,CAAAP,KAAK,CAAC/D,OAAO,UAAAsE,eAAA,iBAAbA,eAAA,CAAe5B,OAAO,GAAIqB,KAAK,CAAC/D,OAAO,CACvDA,OAAO,CAACP,OAAO,CAACM,MAAM,EAAI,CACxB,KAAM,CAAAwE,UAAU,CAAG1D,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,CACnCA,KAAK,CAAC6D,QAAQ,CAACzE,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAAC,CAC5CA,KAAK,IAAMZ,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAAC,CAE5C,GAAI4D,UAAU,GAAKxE,MAAM,CAAC0E,cAAc,EAAI1E,MAAM,CAACT,KAAK,CAAC,CAAE,CACzD,KAAM,CAAAoF,WAAW,CAAG3E,MAAM,CAAC0E,cAAc,EAAI1E,MAAM,CAACT,KAAK,CACzD,GAAIS,MAAM,CAAC4E,YAAY,GAAK,gBAAgB,EAAI5E,MAAM,CAACsE,UAAU,GAAK,gBAAgB,CAAE,CACtFP,UAAU,EAAIzE,UAAU,CAACqF,WAAW,CAAC,CAAG1G,QAAQ,CAClD,CAAC,IAAM,CACL8F,UAAU,EAAIzE,UAAU,CAACqF,WAAW,CAAC,CACvC,CACF,CACF,CAAC,CAAC,CACJ,CACF,CAAC,CAAC,CAEF,MAAO,CAAAZ,UAAU,CACnB,CAAC,CAAE,CAACxG,aAAa,CAAEE,WAAW,CAAEQ,QAAQ,CAAC,CAAC,CAE1C;AACA,KAAM,CAAA4G,UAAU,CAAGtJ,OAAO,CAAC,IAAM,CAC/B,GAAI,CAAAuJ,SAAS,CAAG,CAAC,CAEjB,GAAI/G,iBAAiB,EAAIA,iBAAiB,CAACwB,KAAK,CAAE,CAChDuF,SAAS,CAAGxF,UAAU,CAACvB,iBAAiB,CAACwB,KAAK,CAAC,CACjD,CAAC,IAAM,IAAI5C,OAAO,EAAIA,OAAO,CAAC4C,KAAK,CAAE,CACnCuF,SAAS,CAAGxF,UAAU,CAAC3C,OAAO,CAAC4C,KAAK,CAAC,CACvC,CAEA,MAAO,CAACuF,SAAS,CAAGhB,UAAU,EAAI7F,QAAQ,CAC5C,CAAC,CAAE,CAACF,iBAAiB,CAAEpB,OAAO,CAAEmH,UAAU,CAAE7F,QAAQ,CAAC,CAAC,CAEtD,KAAM,CAAA8G,WAAW,CAAIxF,KAAK,EAAK,CAC7B,MAAO,IAAI,CAAAyF,IAAI,CAACC,YAAY,CAAC,OAAO,CAAE,CACpCC,KAAK,CAAE,UAAU,CACjBC,QAAQ,CAAE,KAAK,CACfC,qBAAqB,CAAE,CAAC,CACxBC,qBAAqB,CAAE,CACzB,CAAC,CAAC,CAACC,MAAM,CAAC/F,KAAK,CAAC,CAClB,CAAC,CAED,KAAM,CAAAgG,gBAAgB,CAAGA,CAAA,GAAM,CAC7B,GAAI5I,OAAO,CAAC8B,IAAI,GAAK,UAAU,CAAE,CAC/B;AACA,GAAI,CAACV,iBAAiB,EAAIA,iBAAiB,CAACyH,YAAY,GAAK,YAAY,CAAE,CACzE,MAAO,MAAK,CACd,CACF,CAEA;AACA,IAAK,KAAM,CAAAxB,KAAK,GAAI,CAAAzG,aAAa,CAAE,CACjC,GAAIyG,KAAK,CAACyB,QAAQ,CAAE,CAClB,KAAM,CAAAnD,OAAO,CAAG0B,KAAK,CAACpF,EAAE,EAAIoF,KAAK,CAAClE,IAAI,CACtC,KAAM,CAAAc,KAAK,CAAGnD,WAAW,CAAC6E,OAAO,CAAC,CAElC,GAAI,CAAC1B,KAAK,EAAKE,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,EAAIA,KAAK,CAACV,MAAM,GAAK,CAAE,CAAE,CAC1D5C,QAAQ,CAAC,iCAAiC0G,KAAK,CAAC0B,KAAK,EAAI1B,KAAK,CAAClE,IAAI,EAAE,CAAC,CACtE,MAAO,MAAK,CACd,CACF,CACF,CAEA,MAAO,KAAI,CACb,CAAC,CAED,KAAM,CAAA6F,eAAe,CAAG,KAAAA,CAAA,GAAY,CAClC,GAAI,CAACJ,gBAAgB,CAAC,CAAC,CAAE,CACvB,GAAI,CAAClI,KAAK,CAAE,CACVC,QAAQ,CAAC,qDAAqD,CAAC,CACjE,CACA,OACF,CAEAgB,eAAe,CAAC,IAAI,CAAC,CAErB,GAAI,KAAAsH,qBAAA,CAAAC,eAAA,CAAAC,gBAAA,CACF;AACA,KAAM,CAAAC,aAAa,CAAG,EAAE,CAExBxI,aAAa,CAACmC,OAAO,CAACsE,KAAK,EAAI,CAC7B,KAAM,CAAA1B,OAAO,CAAG0B,KAAK,CAACpF,EAAE,EAAIoF,KAAK,CAAClE,IAAI,CACtC,KAAM,CAAAc,KAAK,CAAGnD,WAAW,CAAC6E,OAAO,CAAC,CAElC,GAAI1B,KAAK,EAAI,EAAEE,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,EAAIA,KAAK,CAACV,MAAM,GAAK,CAAC,CAAC,CAAE,KAAA8F,eAAA,CAAAC,eAAA,CAC1D;AACA,GAAI,CAAAnC,UAAU,CAAG,CAAC,CAClB,GAAI,CAAAoC,SAAS,CAAG,UAAU,CAE1B;AACA,GAAIlC,KAAK,CAACG,OAAO,EAAIH,KAAK,CAACG,OAAO,CAACC,OAAO,EAAIJ,KAAK,CAACG,OAAO,CAACE,MAAM,CAAE,CAClEP,UAAU,CAAGxE,UAAU,CAAC0E,KAAK,CAACG,OAAO,CAACE,MAAM,CAAC,CAC7C6B,SAAS,CAAGlC,KAAK,CAACG,OAAO,CAAC1F,IAAI,EAAI,OAAO,CAC3C,CACA;AAAA,IACK,IAAIuF,KAAK,CAACzE,KAAK,CAAE,CACpBuE,UAAU,CAAGxE,UAAU,CAAC0E,KAAK,CAACzE,KAAK,CAAC,CACpC2G,SAAS,CAAGlC,KAAK,CAACM,UAAU,EAAI,UAAU,CAC5C,CAEA;AACA,GAAI,CAAC,CAAA0B,eAAA,CAAAhC,KAAK,CAAC/D,OAAO,UAAA+F,eAAA,WAAbA,eAAA,CAAerD,OAAO,EAAIqB,KAAK,CAAC/D,OAAO,GAAKa,KAAK,CAACC,OAAO,CAAC,EAAAkF,eAAA,CAAAjC,KAAK,CAAC/D,OAAO,UAAAgG,eAAA,iBAAbA,eAAA,CAAetD,OAAO,GAAIqB,KAAK,CAAC/D,OAAO,CAAC,CAAE,KAAAkG,eAAA,CACvG,KAAM,CAAAlG,OAAO,CAAG,EAAAkG,eAAA,CAAAnC,KAAK,CAAC/D,OAAO,UAAAkG,eAAA,iBAAbA,eAAA,CAAexD,OAAO,GAAIqB,KAAK,CAAC/D,OAAO,CACvDA,OAAO,CAACP,OAAO,CAACM,MAAM,EAAI,CACxB,KAAM,CAAAwE,UAAU,CAAG1D,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,CACnCA,KAAK,CAAC6D,QAAQ,CAACzE,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAAC,CAC5CA,KAAK,IAAMZ,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAAC,CAE5C,GAAI4D,UAAU,GAAKxE,MAAM,CAAC0E,cAAc,EAAI1E,MAAM,CAACT,KAAK,CAAC,CAAE,CACzDuE,UAAU,CAAGxE,UAAU,CAACU,MAAM,CAAC0E,cAAc,EAAI1E,MAAM,CAACT,KAAK,CAAC,CAC9D2G,SAAS,CAAGlG,MAAM,CAAC4E,YAAY,EAAI5E,MAAM,CAACsE,UAAU,EAAI,UAAU,CACpE,CACF,CAAC,CAAC,CACJ,CAEA;AACAyB,aAAa,CAACK,IAAI,CAAC,CACjBzF,GAAG,CAAEqD,KAAK,CAAClE,IAAI,EAAIkE,KAAK,CAAC0B,KAAK,CAC9B9E,KAAK,CAAEE,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,CAAGA,KAAK,CAACyF,IAAI,CAAC,IAAI,CAAC,CAAGzF,KAAK,CACtD0F,OAAO,CAAEtC,KAAK,CAAC0B,KAAK,EAAI1B,KAAK,CAAClE,IAAI,CAClCP,KAAK,CAAEuE,UAAU,CACjBQ,UAAU,CAAE4B,SACd,CAAC,CAAC,CACJ,CACF,CAAC,CAAC,CAEF,KAAM,CAAAK,QAAQ,CAAG,CACf3H,EAAE,CAAEb,iBAAiB,CAAG,GAAGpB,OAAO,CAACiC,EAAE,IAAIb,iBAAiB,CAACa,EAAE,IAAI4H,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,CAAG,GAAG9J,OAAO,CAACiC,EAAE,IAAI4H,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,CAC7GC,SAAS,CAAE/J,OAAO,CAACiC,EAAE,CACrB+H,WAAW,CAAE5I,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAEa,EAAE,CAClCkB,IAAI,CAAEnD,OAAO,CAACmD,IAAI,CAClBP,KAAK,CAAEsF,UAAU,CAAG5G,QAAQ,CAAE;AAC9B2I,KAAK,CAAE,CAAA7I,iBAAiB,SAAjBA,iBAAiB,kBAAA6H,qBAAA,CAAjB7H,iBAAiB,CAAE6I,KAAK,UAAAhB,qBAAA,iBAAxBA,qBAAA,CAA0BiB,GAAG,KAAAhB,eAAA,CAAIlJ,OAAO,CAACmK,MAAM,UAAAjB,eAAA,kBAAAC,gBAAA,CAAdD,eAAA,CAAiB,CAAC,CAAC,UAAAC,gBAAA,iBAAnBA,gBAAA,CAAqBe,GAAG,GAAI,EAAE,CACtE5I,QAAQ,CACR8I,cAAc,CAAE,CACd9J,UAAU,CAAEY,kBAAkB,CAC9BM,mBAAmB,CAAEA,mBAAmB,CAAC6I,IAAI,CAAC,CAAC,CAC/CC,gBAAgB,CAAElJ,iBAAiB,CAAG,CACpC+B,IAAI,CAAE/B,iBAAiB,CAAC+B,IAAI,CAC5B7C,UAAU,CAAEc,iBAAiB,CAACd,UAChC,CAAC,CAAG,IAAI,CACR;AACAM,aAAa,CAAEwI,aAAa,CAC5BtI,WAAW,CAAEA,WAAW,CACxBE,UAAU,CAAEqE,MAAM,CAACD,IAAI,CAACpE,UAAU,CAAC,CAACuC,MAAM,CAAG,CAAC,CAAGvC,UAAU,CAAG,IAAI,CAClE;AACAuJ,WAAW,CAAEpD,UACf,CACF,CAAC,CAEDhH,SAAS,CAACyJ,QAAQ,CAAC,CAEnB;AACArD,UAAU,CAAC,IAAM,CACfrG,OAAO,CAAC,CAAC,CACT0B,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,GAAG,CAAC,CAET,CAAE,MAAO+B,GAAG,CAAE,CACZhD,QAAQ,CAAC,2DAA2D,CAAC,CACvE,CAAC,OAAS,CACRgB,eAAe,CAAC,KAAK,CAAC,CACxB,CACF,CAAC,CAED,KAAM,CAAA6I,gBAAgB,CAAInD,KAAK,EAAK,KAAAoD,eAAA,CAAAC,eAAA,CAAAC,eAAA,CAClC,KAAM,CAAAhF,OAAO,CAAG0B,KAAK,CAACpF,EAAE,EAAIoF,KAAK,CAAClE,IAAI,CACtC,KAAM,CAAAc,KAAK,CAAGnD,WAAW,CAAC6E,OAAO,CAAC,EAAI,EAAE,CAExC,OAAQ0B,KAAK,CAACvF,IAAI,EAChB,IAAK,MAAM,CACX,IAAK,aAAa,CAChB,mBACErC,IAAA,UACEqC,IAAI,CAAC,MAAM,CACXmC,KAAK,CAAEA,KAAM,CACb2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAE,CAC5D8G,WAAW,CAAE1D,KAAK,CAAC0D,WAAW,EAAI,EAAG,CACrCC,SAAS,CAAE3D,KAAK,CAAC4D,GAAG,EAAInF,SAAU,CAClCoF,SAAS,CAAC,kBAAkB,CAC5BpC,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAC1B,CAAC,CAGN,IAAK,UAAU,CACf,IAAK,iBAAiB,CACpB,mBACErJ,IAAA,aACEwE,KAAK,CAAEA,KAAM,CACb2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAE,CAC5D8G,WAAW,CAAE1D,KAAK,CAAC0D,WAAW,EAAI,EAAG,CACrCC,SAAS,CAAE3D,KAAK,CAAC4D,GAAG,EAAInF,SAAU,CAClCqF,IAAI,CAAE,CAAE,CACRD,SAAS,CAAC,gBAAgB,CAC1BpC,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAC1B,CAAC,CAGN,IAAK,QAAQ,CACX,mBACErJ,IAAA,UACEqC,IAAI,CAAC,QAAQ,CACbmC,KAAK,CAAEA,KAAM,CACb2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEhD,UAAU,CAACkI,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAC,EAAI,CAAC,CAAE,CAC7E4B,GAAG,CAAEwB,KAAK,CAACxB,GAAG,EAAIC,SAAU,CAC5BmF,GAAG,CAAE5D,KAAK,CAAC4D,GAAG,EAAInF,SAAU,CAC5BsF,IAAI,CAAE/D,KAAK,CAAC+D,IAAI,EAAI,CAAE,CACtBF,SAAS,CAAC,oBAAoB,CAC9BpC,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAC1B,CAAC,CAGN,IAAK,OAAO,CACV,mBACErJ,IAAA,UACEqC,IAAI,CAAC,OAAO,CACZmC,KAAK,CAAEA,KAAM,CACb2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAE,CAC5D8G,WAAW,CAAE1D,KAAK,CAAC0D,WAAW,EAAI,mBAAoB,CACtDG,SAAS,CAAC,mBAAmB,CAC7BpC,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAC1B,CAAC,CAGN,IAAK,QAAQ,CACb,IAAK,UAAU,CACb,KAAM,CAAAuC,aAAa,CAAG,EAAAZ,eAAA,CAAApD,KAAK,CAAC/D,OAAO,UAAAmH,eAAA,iBAAbA,eAAA,CAAezE,OAAO,GAAIqB,KAAK,CAAC/D,OAAO,EAAI,EAAE,CACnE,mBACE3D,KAAA,WACEsE,KAAK,CAAEA,KAAM,CACb2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAE,CAC5DiH,SAAS,CAAC,cAAc,CACxBpC,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAAAwC,QAAA,eAEzB7L,IAAA,WAAQwE,KAAK,CAAC,EAAE,CAAAqH,QAAA,CAAC,0BAAqB,CAAQ,CAAC,CAC9CD,aAAa,CAACE,GAAG,CAAC,CAAClI,MAAM,CAAEmI,KAAK,gBAC/B7L,KAAA,WAAoBsE,KAAK,CAAEZ,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAM,CAAAqH,QAAA,EACrDjI,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAC3BZ,MAAM,CAAC0E,cAAc,EAAI1E,MAAM,CAAC0E,cAAc,CAAG,CAAC,EAAK,MAAMK,WAAW,CAAC/E,MAAM,CAAC0E,cAAc,CAAC,GAAG,GAFzFyD,KAGL,CACT,CAAC,EACI,CAAC,CAGb,IAAK,OAAO,CACZ,IAAK,aAAa,CAChB;AACA,KAAM,CAAAC,YAAY,CAAG,EAAAf,eAAA,CAAArD,KAAK,CAAC/D,OAAO,UAAAoH,eAAA,iBAAbA,eAAA,CAAe1E,OAAO,GAAIqB,KAAK,CAAC/D,OAAO,EAAI,EAAE,CAClE,mBACE7D,IAAA,QAAKyL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,CAC/BG,YAAY,CAACF,GAAG,CAAC,CAAClI,MAAM,CAAEmI,KAAK,gBAC9B7L,KAAA,UAAmBuL,SAAS,CAAC,oBAAoB,CAAAI,QAAA,eAC/C7L,IAAA,UACEqC,IAAI,CAAC,OAAO,CACZqB,IAAI,CAAEwC,OAAQ,CACd1B,KAAK,CAAEZ,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAM,CACpCyH,OAAO,CAAEzH,KAAK,IAAMZ,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAAE,CAClD2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAE,CAC5D6E,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAC1B,CAAC,cACFnJ,KAAA,SAAMuL,SAAS,CAAC,aAAa,CAAAI,QAAA,EAC1BjI,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAC3BZ,MAAM,CAAC0E,cAAc,EAAI1E,MAAM,CAAC0E,cAAc,CAAG,CAAC,EAAK,MAAMK,WAAW,CAAC/E,MAAM,CAAC0E,cAAc,CAAC,GAAG,EAChG,CAAC,GAZGyD,KAaL,CACR,CAAC,CACC,CAAC,CAGV,IAAK,UAAU,CACf,IAAK,YAAY,CACjB,IAAK,iBAAiB,CACpB,KAAM,CAAAG,eAAe,CAAG,EAAAhB,eAAA,CAAAtD,KAAK,CAAC/D,OAAO,UAAAqH,eAAA,iBAAbA,eAAA,CAAe3E,OAAO,GAAIqB,KAAK,CAAC/D,OAAO,EAAI,EAAE,CACrE,mBACE7D,IAAA,QAAKyL,SAAS,CAAC,sBAAsB,CAAAI,QAAA,CAClCK,eAAe,CAACJ,GAAG,CAAC,CAAClI,MAAM,CAAEmI,KAAK,gBACjC7L,KAAA,UAAmBuL,SAAS,CAAC,uBAAuB,CAAAI,QAAA,eAClD7L,IAAA,UACEqC,IAAI,CAAC,UAAU,CACfmC,KAAK,CAAEZ,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAM,CACpCyH,OAAO,CAAEvH,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,EAAIA,KAAK,CAAC6D,QAAQ,CAACzE,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAAE,CAC9E2G,QAAQ,CAAGC,CAAC,EAAK,CACf,KAAM,CAAAe,WAAW,CAAGvI,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAChD,KAAM,CAAA4H,aAAa,CAAG1H,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,CAAGA,KAAK,CAAG,EAAE,CAEvD,GAAI4G,CAAC,CAACC,MAAM,CAACY,OAAO,CAAE,CACpB1E,iBAAiB,CAACrB,OAAO,CAAE,CAAC,GAAGkG,aAAa,CAAED,WAAW,CAAC,CAAC,CAC7D,CAAC,IAAM,CACL5E,iBAAiB,CAACrB,OAAO,CAAEkG,aAAa,CAAC1J,MAAM,CAAC2J,CAAC,EAAIA,CAAC,GAAKF,WAAW,CAAC,CAAC,CAC1E,CACF,CAAE,CACH,CAAC,cACFjM,KAAA,SAAMuL,SAAS,CAAC,gBAAgB,CAAAI,QAAA,EAC7BjI,MAAM,CAACkC,KAAK,EAAIlC,MAAM,CAACY,KAAK,CAC3BZ,MAAM,CAAC0E,cAAc,EAAI1E,MAAM,CAAC0E,cAAc,CAAG,CAAC,EAAK,MAAMK,WAAW,CAAC/E,MAAM,CAAC0E,cAAc,CAAC,GAAG,EAChG,CAAC,GAnBGyD,KAoBL,CACR,CAAC,CACC,CAAC,CAGV,IAAK,MAAM,CACX,IAAK,aAAa,CAChB,mBACE7L,KAAA,QAAKuL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,eAChC3L,KAAA,UAAOuL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,eAClC7L,IAAA,UACEqC,IAAI,CAAC,MAAM,CACX8I,QAAQ,CAAGC,CAAC,EAAK5D,gBAAgB,CAACtB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAACiB,KAAK,CAAC,CAAC,CAAC,CAAE,CAC9DC,MAAM,CAAE3E,KAAK,CAAC4E,aAAa,EAAI,GAAI,CACnCnD,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CACzBoC,SAAS,CAAC,YAAY,CACvB,CAAC,cACFvL,KAAA,SAAMuL,SAAS,CAAC,oBAAoB,CAAAI,QAAA,eAClC7L,IAAA,CAACL,MAAM,EAAC8M,IAAI,CAAE,EAAG,CAAE,CAAC,CACnBlL,UAAU,CAAC2E,OAAO,CAAC,CAAG3E,UAAU,CAAC2E,OAAO,CAAC,CAACxC,IAAI,CAAG,qBAAqB,EACnE,CAAC,EACF,CAAC,CACPkE,KAAK,CAAC8E,QAAQ,eACbxM,KAAA,MAAGuL,SAAS,CAAC,gBAAgB,CAAAI,QAAA,EAAC,uBACb,CAACjE,KAAK,CAAC8E,QAAQ,CAAC,IACjC,EAAG,CACJ,EACE,CAAC,CAGV,IAAK,OAAO,CACV,mBACE1M,IAAA,UACEqC,IAAI,CAAC,OAAO,CACZmC,KAAK,CAAEA,KAAK,EAAI,SAAU,CAC1B2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAE,CAC5DiH,SAAS,CAAC,mBAAmB,CAC7BpC,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAC1B,CAAC,CAGN,IAAK,MAAM,CACT,mBACErJ,IAAA,UACEqC,IAAI,CAAC,MAAM,CACXmC,KAAK,CAAEA,KAAM,CACb2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAE,CAC5D4B,GAAG,CAAEwB,KAAK,CAAC+E,QAAQ,EAAItG,SAAU,CACjCmF,GAAG,CAAE5D,KAAK,CAACgF,QAAQ,EAAIvG,SAAU,CACjCoF,SAAS,CAAC,kBAAkB,CAC5BpC,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAC1B,CAAC,CAGN,IAAK,YAAY,CACf,mBACEnJ,KAAA,UAAOuL,SAAS,CAAC,uBAAuB,CAAAI,QAAA,eACtC7L,IAAA,UACEqC,IAAI,CAAC,UAAU,CACf4J,OAAO,CAAEzH,KAAK,GAAK,IAAK,CACxB2G,QAAQ,CAAGC,CAAC,EAAK7D,iBAAiB,CAACrB,OAAO,CAAEkF,CAAC,CAACC,MAAM,CAACY,OAAO,CAAE,CAC9D5C,QAAQ,CAAEzB,KAAK,CAACyB,QAAS,CAC1B,CAAC,cACFrJ,IAAA,SAAMyL,SAAS,CAAC,gBAAgB,CAAAI,QAAA,CAC7BjE,KAAK,CAACiF,UAAU,EAAI,IAAI,CACrB,CAAC,EACF,CAAC,CAGZ,QACE,MAAO,KAAI,CACf,CACF,CAAC,CAED,GAAI,CAACrM,MAAM,CAAE,MAAO,KAAI,CAExB,mBACER,IAAA,QAAKyL,SAAS,CAAC,6BAA6B,CAACqB,OAAO,CAAErM,OAAQ,CAAAoL,QAAA,cAC5D3L,KAAA,QAAKuL,SAAS,CAAC,qBAAqB,CAACqB,OAAO,CAAG1B,CAAC,EAAKA,CAAC,CAAC2B,eAAe,CAAC,CAAE,CAAAlB,QAAA,eACvE7L,IAAA,WAAQyL,SAAS,CAAC,aAAa,CAACqB,OAAO,CAAErM,OAAQ,CAAAoL,QAAA,cAC/C7L,IAAA,CAACZ,CAAC,EAACqN,IAAI,CAAE,EAAG,CAAE,CAAC,CACT,CAAC,cAETzM,IAAA,OAAA6L,QAAA,CAAI,qBAAmB,CAAI,CAAC,CAE3B9K,OAAO,cACNb,KAAA,QAAKuL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,eAChC7L,IAAA,CAACP,MAAM,EAACgM,SAAS,CAAC,iBAAiB,CAACgB,IAAI,CAAE,EAAG,CAAE,CAAC,cAChDzM,IAAA,MAAA6L,QAAA,CAAG,sBAAoB,CAAG,CAAC,EACxB,CAAC,CACJ5K,KAAK,cACPf,KAAA,QAAKuL,SAAS,CAAC,iBAAiB,CAAAI,QAAA,eAC9B7L,IAAA,MAAGyL,SAAS,CAAC,eAAe,CAAAI,QAAA,CAAE5K,KAAK,CAAI,CAAC,cACxCjB,IAAA,WAAQ8M,OAAO,CAAE1K,eAAgB,CAACqJ,SAAS,CAAC,cAAc,CAAAI,QAAA,CAAC,YAE3D,CAAQ,CAAC,EACN,CAAC,cAEN3L,KAAA,CAAAE,SAAA,EAAAyL,QAAA,eAEE3L,KAAA,QAAKuL,SAAS,CAAC,4BAA4B,CAAAI,QAAA,EACxCtL,OAAO,CAACmK,MAAM,EAAInK,OAAO,CAACmK,MAAM,CAAC,CAAC,CAAC,cAClC1K,IAAA,QACEyK,GAAG,CAAElK,OAAO,CAACmK,MAAM,CAAC,CAAC,CAAC,CAACD,GAAI,CAC3BuC,GAAG,CAAEzM,OAAO,CAACmD,IAAK,CAClB+H,SAAS,CAAC,6BAA6B,CACxC,CAAC,cAEFzL,IAAA,QAAKyL,SAAS,CAAC,yCAAyC,CAAAI,QAAA,cACtD7L,IAAA,CAACN,KAAK,EAAC+M,IAAI,CAAE,EAAG,CAAE,CAAC,CAChB,CACN,cACDvM,KAAA,QAAKuL,SAAS,CAAC,iBAAiB,CAAAI,QAAA,eAC9B7L,IAAA,OAAA6L,QAAA,CAAKtL,OAAO,CAACmD,IAAI,CAAK,CAAC,CAEtBnD,OAAO,CAAC0M,iBAAiB,eACxBjN,IAAA,MAAGyL,SAAS,CAAC,qBAAqB,CAC/ByB,uBAAuB,CAAE,CAAEC,MAAM,CAAE5M,OAAO,CAAC0M,iBAAkB,CAAE,CAAE,CACrE,CAEA,CAAC1M,OAAO,CAAC0M,iBAAiB,EAAI1M,OAAO,CAAC6M,WAAW,eAChDpN,IAAA,MAAGyL,SAAS,CAAC,qBAAqB,CAC/ByB,uBAAuB,CAAE,CAAEC,MAAM,CAAE5M,OAAO,CAAC6M,WAAY,CAAE,CAAE,CAC/D,cAEDlN,KAAA,QAAKuL,SAAS,CAAC,cAAc,CAAAI,QAAA,eAC3B7L,IAAA,SAAMyL,SAAS,CAAC,aAAa,CAAAI,QAAA,CAAC,UAAQ,CAAM,CAAC,cAC7C7L,IAAA,SAAMyL,SAAS,CAAC,aAAa,CAAAI,QAAA,CAAElD,WAAW,CAACF,UAAU,CAAG5G,QAAQ,CAAC,CAAO,CAAC,CACxEF,iBAAiB,EAAIA,iBAAiB,CAACd,UAAU,eAChDX,KAAA,SAAMuL,SAAS,CAAC,eAAe,CAAAI,QAAA,EAAC,KAAG,CAAClK,iBAAiB,CAACd,UAAU,CAACiL,GAAG,CAACnJ,IAAI,EAAIA,IAAI,CAACiB,MAAM,CAAC,CAACqG,IAAI,CAAC,IAAI,CAAC,EAAO,CAC5G,EACE,CAAC,EACH,CAAC,EACH,CAAC,CAGLpJ,UAAU,CAACiD,MAAM,CAAG,CAAC,eACpB9D,IAAA,QAAKyL,SAAS,CAAC,uBAAuB,CAAAI,QAAA,CACnChL,UAAU,CAACiL,GAAG,CAACuB,SAAS,eACvBnN,KAAA,QAA0CuL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,eACrE7L,IAAA,OAAA6L,QAAA,CAAKwB,SAAS,CAAC3J,IAAI,CAAK,CAAC,CACxB2J,SAAS,CAACD,WAAW,eACpBpN,IAAA,MAAGyL,SAAS,CAAC,qBAAqB,CAAAI,QAAA,CAAEwB,SAAS,CAACD,WAAW,CAAI,CAC9D,cACDpN,IAAA,QAAKyL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,CAC/BwB,SAAS,CAACxJ,OAAO,CACfyJ,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,CACd;AACA,GAAIH,SAAS,CAAC3J,IAAI,CAACC,WAAW,CAAC,CAAC,GAAK,QAAQ,EAAI0J,SAAS,CAAC3J,IAAI,CAACC,WAAW,CAAC,CAAC,GAAK,QAAQ,CAAE,CAC1F,GAAI4J,CAAC,CAAC5J,WAAW,CAAC,CAAC,GAAK,UAAU,CAAE,MAAO,CAAC,CAAC,CAC7C,GAAI6J,CAAC,CAAC7J,WAAW,CAAC,CAAC,GAAK,UAAU,CAAE,MAAO,EAAC,CAC9C,CACA,MAAO,EAAC,CACV,CAAC,CAAC,CACDmI,GAAG,CAAClI,MAAM,eACX1D,KAAA,UAAoBuL,SAAS,CAAC,kBAAkB,CAAAI,QAAA,eAC9C7L,IAAA,UACEqC,IAAI,CAAC,OAAO,CACZqB,IAAI,CAAE2J,SAAS,CAAC3J,IAAK,CACrBc,KAAK,CAAEZ,MAAO,CACdqI,OAAO,CAAExK,kBAAkB,CAAC4L,SAAS,CAAC3J,IAAI,CAAC,GAAKE,MAAO,CACvDuH,QAAQ,CAAEA,CAAA,GAAMxE,qBAAqB,CAAC0G,SAAS,CAAC3J,IAAI,CAAEE,MAAM,CAAE,CAC/D,CAAC,cACF1D,KAAA,SAAMuL,SAAS,CAAC,cAAc,CAAAI,QAAA,eAC5B7L,IAAA,SAAMyL,SAAS,CAAC,cAAc,CAAAI,QAAA,cAC5B7L,IAAA,CAACR,KAAK,EAACiN,IAAI,CAAE,EAAG,CAAE,CAAC,CACf,CAAC,CACN7I,MAAM,EACH,CAAC,GAbGA,MAcL,CACR,CAAC,CACC,CAAC,GAhCEyJ,SAAS,CAAC7K,EAAE,EAAI6K,SAAS,CAAC3J,IAiC/B,CACN,CAAC,CACC,CACN,CAGAvC,aAAa,CAAC2C,MAAM,CAAG,CAAC,eACvB5D,KAAA,QAAKuL,SAAS,CAAC,uBAAuB,CAAAI,QAAA,eACpC7L,IAAA,OAAA6L,QAAA,CAAI,sBAAoB,CAAI,CAAC,CAC5B1K,aAAa,CAAC2K,GAAG,CAAC,CAAClE,KAAK,CAAEmE,KAAK,QAAA0B,cAAA,CAAAC,eAAA,oBAC9BxN,KAAA,QAA2CuL,SAAS,CAAC,aAAa,CAAAI,QAAA,eAChE3L,KAAA,UAAOuL,SAAS,CAAC,aAAa,CAAAI,QAAA,EAC3BjE,KAAK,CAAC9B,KAAK,EAAI8B,KAAK,CAAC0B,KAAK,EAAI1B,KAAK,CAAClE,IAAI,EAAI,iBAAiB,CAC7DkE,KAAK,CAACyB,QAAQ,eAAIrJ,IAAA,SAAMyL,SAAS,CAAC,UAAU,CAAAI,QAAA,CAAC,GAAC,CAAM,CAAC,CACpD,EAAA4B,cAAA,CAAA7F,KAAK,CAACG,OAAO,UAAA0F,cAAA,iBAAbA,cAAA,CAAezF,OAAO,GAAI,EAAA0F,eAAA,CAAA9F,KAAK,CAACG,OAAO,UAAA2F,eAAA,iBAAbA,eAAA,CAAezF,MAAM,EAAG,CAAC,eACnDjI,IAAA,SAAMyL,SAAS,CAAC,aAAa,CAAAI,QAAA,CAC1BjE,KAAK,CAACG,OAAO,CAAC1F,IAAI,GAAK,gBAAgB,CACpC,MAAMsG,WAAW,CAACf,KAAK,CAACG,OAAO,CAACE,MAAM,CAAC,cAAc,CACrD,MAAMU,WAAW,CAACf,KAAK,CAACG,OAAO,CAACE,MAAM,CAAC,GAAG,CAE1C,CACP,EACI,CAAC,CACPL,KAAK,CAACwF,WAAW,eAChBpN,IAAA,MAAGyL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,CAAEjE,KAAK,CAACwF,WAAW,CAAI,CACxD,CACArC,gBAAgB,CAACnD,KAAK,CAAC,GAhBhBA,KAAK,CAACpF,EAAE,EAAIoF,KAAK,CAAClE,IAAI,EAAIqI,KAiB/B,CAAC,EACP,CAAC,EACC,CACN,CAGApK,iBAAiB,GAAKA,iBAAiB,CAACyH,YAAY,GAAK,YAAY,EACnEzH,iBAAiB,CAACgM,cAAc,EAAIhM,iBAAiB,CAACgM,cAAc,CAAG,EAAG,CAAC,eAC5E3N,IAAA,QAAKyL,SAAS,CAAC,gBAAgB,CAAAI,QAAA,cAC7B7L,IAAA,QAAKyL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,CAC/BlK,iBAAiB,CAACyH,YAAY,GAAK,YAAY,cAC9CpJ,IAAA,MAAGyL,SAAS,CAAC,cAAc,CAAAI,QAAA,CAAC,+BAAmB,CAAG,CAAC,CACjDlK,iBAAiB,CAACgM,cAAc,EAAIhM,iBAAiB,CAACgM,cAAc,CAAG,EAAE,cAC3EzN,KAAA,MAAGuL,SAAS,CAAC,WAAW,CAAAI,QAAA,EAAC,oBAAU,CAAClK,iBAAiB,CAACgM,cAAc,CAAC,WAAS,EAAG,CAAC,CAChF,IAAI,CACL,CAAC,CACH,CACN,cAGDzN,KAAA,QAAKuL,SAAS,CAAC,uBAAuB,CAAAI,QAAA,eACpC7L,IAAA,OAAA6L,QAAA,CAAI,qCAAmC,CAAI,CAAC,cAC5C7L,IAAA,MAAGyL,SAAS,CAAC,qBAAqB,CAAAI,QAAA,CAAC,kCAEnC,CAAG,CAAC,cACJ7L,IAAA,aACEyL,SAAS,CAAC,sBAAsB,CAChCjH,KAAK,CAAEzC,mBAAoB,CAC3BoJ,QAAQ,CAAGC,CAAC,EAAKpJ,sBAAsB,CAACoJ,CAAC,CAACC,MAAM,CAAC7G,KAAK,CAAE,CACxD8G,WAAW,CAAC,oCAAoC,CAChDI,IAAI,CAAE,CAAE,CACT,CAAC,EACC,CAAC,cAGNxL,KAAA,QAAKuL,SAAS,CAAC,wBAAwB,CAAAI,QAAA,eACrC3L,KAAA,QAAKuL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,eAChC7L,IAAA,OAAA6L,QAAA,CAAI,UAAQ,CAAI,CAAC,cACjB3L,KAAA,QAAKuL,SAAS,CAAC,mBAAmB,CAAAI,QAAA,eAChC7L,IAAA,WACE8M,OAAO,CAAEA,CAAA,GAAMhL,WAAW,CAAC8L,IAAI,CAACpC,GAAG,CAAC,CAAC,CAAE3J,QAAQ,CAAG,CAAC,CAAC,CAAE,CACtDgM,QAAQ,CAAEhM,QAAQ,EAAI,CAAE,CAAAgK,QAAA,cAExB7L,IAAA,CAACV,KAAK,EAACmN,IAAI,CAAE,EAAG,CAAE,CAAC,CACb,CAAC,cACTzM,IAAA,SAAMyL,SAAS,CAAC,gBAAgB,CAAAI,QAAA,CAAEhK,QAAQ,CAAO,CAAC,cAClD7B,IAAA,WACE8M,OAAO,CAAEA,CAAA,GAAMhL,WAAW,CAACD,QAAQ,CAAG,CAAC,CAAE,CACzCgM,QAAQ,CAAE,CAAAlM,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAEyH,YAAY,IAAK,YAAa,CAAAyC,QAAA,cAE3D7L,IAAA,CAACX,IAAI,EAACoN,IAAI,CAAE,EAAG,CAAE,CAAC,CACZ,CAAC,EACN,CAAC,EACH,CAAC,cAENvM,KAAA,QAAKuL,SAAS,CAAC,YAAY,CAAAI,QAAA,eACzB7L,IAAA,OAAA6L,QAAA,CAAI,OAAK,CAAI,CAAC,cACd7L,IAAA,MAAGyL,SAAS,CAAC,aAAa,CAAAI,QAAA,CAAElD,WAAW,CAACF,UAAU,CAAC,CAAI,CAAC,EACrD,CAAC,EACH,CAAC,cAGNzI,IAAA,WACEyL,SAAS,CAAE,sBAAsBxJ,YAAY,CAAG,SAAS,CAAG,EAAE,EAAG,CACjE6K,OAAO,CAAEvD,eAAgB,CACzBsE,QAAQ,CAAE5L,YAAY,EAAK,CAAAN,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAEyH,YAAY,IAAK,YAAc,CAAAyC,QAAA,CAE5E5J,YAAY,cACX/B,KAAA,CAAAE,SAAA,EAAAyL,QAAA,eACE7L,IAAA,CAACP,MAAM,EAACgM,SAAS,CAAC,gBAAgB,CAACgB,IAAI,CAAE,EAAG,CAAE,CAAC,eAEjD,EAAE,CAAC,cAEHvM,KAAA,CAAAE,SAAA,EAAAyL,QAAA,eACE7L,IAAA,CAACJ,YAAY,EAAC6M,IAAI,CAAE,EAAG,CAAE,CAAC,qBAE5B,EAAE,CACH,CACK,CAAC,EACT,CACH,EACE,CAAC,CACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAApM,kBAAkB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}